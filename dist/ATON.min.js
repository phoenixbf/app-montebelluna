parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"XTSP":[function(require,module,exports) {
"use strict";function t(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;class e extends THREE.Group{constructor(e,i){super(),t(this,"updateLightProbes",()=>(this.traverse(t=>{if(t.isMesh&&t.geometry){let e=t.userData.LP;void 0!==e&&(e.update(),t.material.envMap=e.getEnvTex())}}),this)),this.type=i||ATON.NTYPES.SCENE,this.enablePicking(),this.type===ATON.NTYPES.SCENE&&(this._rootG=ATON._rootVisible,this._nodes=ATON.snodes),this.type===ATON.NTYPES.SEM&&(this._rootG=ATON._rootSem,this._nodes=ATON.semnodes),this.type===ATON.NTYPES.UI&&(this._rootG=ATON._rootUI,this._nodes=ATON.uinodes),this.as(e),this.kwords=void 0,this._bCloneOnLoadHit=!0,this._tlist=void 0,this._aniMixers=void 0,this.castShadow=!1,this.receiveShadow=!1,this.onHover=void 0,this.onLeave=void 0,this.onSelect=void 0}as(t){if(void 0!==t&&t!==ATON.ROOT_NID)return this._nodes[t]=this,this.nid=t,this.name=t,this}setAsRoot(){return this._nodes[ATON.ROOT_NID]=this,this.nid=ATON.ROOT_NID,this}setCloneOnLoadHit(t){return this._bCloneOnLoadHit=t,this}addKeywords(t){let e=t.split(",");void 0===this.kwords&&(this.kwords={});for(let i in e){let t=e[i].trim();t.length>0&&(this.kwords[t]=!0)}for(let i in this.children){let e=this.children[i];void 0!==e.type&&e.addKeywords(t)}return this}hasKeyword(t){if(void 0!==this.kwords)return void 0!==this.kwords[t]}setDescription(t){return this.userData.description=t,this}getDescription(){return this.userData.description}setAudio(t){return this.userData.audio=t,this}getAudio(){return this.userData.audio}hide(){return this.visible=!1,ATON.Utils.setPicking(this,this.type,!1),ATON._renderer.shadowMap.enabled&&(ATON._dMainL.shadow.needsUpdate=!0),this}show(){return this.visible=!0,ATON.Utils.setPicking(this,this.type,this.bPickable),ATON._renderer.shadowMap.enabled&&(ATON._dMainL.shadow.needsUpdate=!0),this}toggle(t){return void 0===t?this.visible?this.hide():this.show():t?this.show():this.hide()}disablePicking(){return this.bPickable=!1,ATON.Utils.setPicking(this,this.type,this.bPickable),this}enablePicking(){return this.bPickable=!0,ATON.Utils.setPicking(this,this.type,this.bPickable),this}setPickable(t){return t?this.enablePicking():this.disablePicking(),this}setMaterial(t){this.userData.cMat=t,this.traverse(e=>{e.isMesh&&(e.material=t),e.type&&(this.userData.cMat=t)});for(let e in this.children){let i=this.children[e];i.setMaterial&&i.setMaterial(t)}return this}getMaterial(){return this.userData.cMat}setDefaultAndHighlightMaterials(t,e){return this.userData.matSTD=t,this.userData.matHL=e,this}highlight(){return this.userData.matHL&&this.setMaterial(this.userData.matHL),this}restoreDefaultMaterial(){return this.userData.matSTD&&this.setMaterial(this.userData.matSTD),this}setOpacity(t){return this.traverse(e=>{e.isMesh&&(e.material.opacity=t)}),this}setShadowCast(t){return this.castShadow=t,this.traverse(e=>{e.isMesh&&(e.castShadow=t)}),this}setShadowReceive(t){return this.receiveShadow=t,this.traverse(e=>{e.isMesh&&(e.receiveShadow=t)}),this}setEnvMap(t){return this.traverse(e=>{e.isMesh&&(e.material.envMap=t)}),this}assignLightProbe(t){return this.traverse(e=>{e.isMesh&&e.geometry&&ATON.Utils.assignLightProbeToMesh(t,e)}),this}assignLightProbesByProximity(){return 0===ATON._lps.length?this:(this.traverse(t=>{if(t.isMesh&&t.geometry){let e=new THREE.Vector3,i=((new THREE.Box3).setFromObject(t).getCenter(e),void 0),s=void 0;for(let t in ATON._lps){let r=ATON._lps[t],o=e.distanceToSquared(r.pos);(void 0===i||o<s)&&(s=o,i=r)}i&&ATON.Utils.assignLightProbeToMesh(i,t)}}),this)}duplicate(){let t=this.clone();return t.traverse(t=>{t.isMesh&&(t.material=t.material.clone())}),t}delete(){let t=this.parent;void 0!==t&&void 0!==t.nid&&t.removeChild(this)}removeChild(t){if(void 0===t)return;t.nid;return void 0!==t.nid&&(this._nodes[t.nid]=void 0),t.parent=void 0,t.traverse(t=>{t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose()}),this.remove(t),this}removeChildren(){for(let t=this.children.length-1;t>=0;t--)this.removeChild(this.children[t]);return this}attachTo(t){let e="string"==typeof t?this._nodes[t]:t;return e&&(e.add(this),void 0!==e.userData.cMat&&(this.userData.cMat=e.userData.cMat),void 0!==e.bPickable&&(this.bPickable=e.bPickable)),e}attachToRoot(){return this._rootG.add(this),void 0!==this._rootG.userData.cMat&&(this.userData.cMat=this._rootG.userData.cMat),void 0!==this._rootG.bPickable&&(this.bPickable=this._rootG.bPickable),this._rootG}getBound(){let t=(new THREE.Box3).setFromObject(this),e=new THREE.Sphere;return t.getBoundingSphere(e),e}setPosition(t,e,i){return t instanceof THREE.Vector3?this.position.copy(t):this.position.set(t,e,i),this}setScale(t,e,i){return t instanceof THREE.Vector3?this.scale.copy(t):(void 0===e&&(e=t,i=t),this.scale.set(t,e,i)),this}setRotation(t,e,i){return t instanceof THREE.Vector3?this.rotation.copy(t):this.rotation.set(t,e,i),this}orientToCamera(){return this.quaternion.copy(ATON.Nav._qOri),this}setYup(){return this.rotation.set(-1.57079632679,0,0),this}addTransform(t){let e=void 0;return"string"==typeof t&&(e=ATON.Utils.parseTransformString(t)),void 0===e?this:(void 0===this._tlist&&(this._tlist=[]),this._tlist.push(e),this)}load(t,e){if(void 0===t)return this;t=ATON.Utils.resolveCollectionURL(t);let i=this;if(t.endsWith("tileset.json"))return ATON.Utils.loadTileSet(t,i),ATON._bqScene=!0,e&&e(),i;if(i._bCloneOnLoadHit&&void 0!==ATON._assetsManager[t])return ATON._assetsManager[t].then(t=>{let s=t.clone();if(ATON.Utils.modelVisitor(i,s),void 0!==i._tlist)for(let e in i._tlist)i._tlist[e].add(s.clone()),i.add(i._tlist[e]);else i.add(s);e&&e()}),console.log("HIT!"),i;ATON._assetReqNew(t);let s=new Promise((s,r)=>{ATON._aLoader.load(t,r=>{let o=r.scene||r.scene[0];if(ATON.Utils.modelVisitor(i,o),void 0!==i._tlist)for(let t in i._tlist)i._tlist[t].add(o.clone()),i.add(i._tlist[t]);else i.add(o);ATON.Utils.registerAniMixers(i,r),ATON.Utils.ccExtract(r),s(o),console.log("Model "+t+" loaded"),ATON._assetReqComplete(t),i.type===ATON.NTYPES.SCENE&&(ATON._bqScene=!0),i.type===ATON.NTYPES.SEM&&(ATON._bqSem=!0),i.bPickable&&i.enablePicking(),e&&e()},void 0,i=>{ATON._assetReqComplete(t),e&&e()})});return i._bCloneOnLoadHit&&(ATON._assetsManager[t]=s),this}exportAs(t){return ATON.Utils.exportNode(this,t),this}setOnHover(t){return this.onHover=f,this}setOnLeave(t){return this.onLeave=f,this}setOnSelect(t){return this.onSelect=f,this}}var i=e;exports.default=i;
},{}],"CwXu":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;class t{constructor(t){this.pos=new THREE.Vector3(1,0,0),this.target=new THREE.Vector3(0,0,0),this.up=ATON.STD_UPVECTOR,this.fov=void 0,this.nextPOV=void 0,this.prevPOV=void 0,this.as(t)}as(t){if(void 0!==t)return ATON.Nav.povlist[t]=this,this.id=t,this}setPosition(t,s,e){return t instanceof THREE.Vector3?this.pos.copy(t):this.pos.set(t,s,e),this}setTarget(t,s,e){return t instanceof THREE.Vector3?this.target.copy(t):this.target.set(t,s,e),this}setFOV(t){return this.fov=t,this}addKeywords(t){let s=t.split(",");void 0===this.kwords&&(this.kwords={});for(let e in s){let t=s[e].trim();t.length>0&&(this.kwords[t]=!0)}return this}hasKeyword(t){if(void 0!==this.kwords)return void 0!==this.kwords[t]}setNextPOV(t){if(t)return this.nextPOV=t,this}setPrevPOV(t){if(t)return this.prevPOV=t,this}}var s=t;exports.default=s;
},{}],"MNcy":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;class e{constructor(e,t,s){this.pos=new THREE.Vector3(0,0,0),this._res=void 0!==e?e:64,this._near=void 0!==t?t:1,this._far=void 0!==s?s:ATON.Nav.STD_FAR,this._envtex=void 0,this._prevCCtarget=void 0}setPosition(e,t,s){return e instanceof THREE.Vector3?this.pos.copy(e):this.pos.set(e,t,s),this}setNear(e){return this._near=e,this}setFar(e){return this._far=e,this}update(){this._envtex&&this._envtex.dispose(),this._prevCCtarget&&this._prevCCtarget.dispose();let e=new THREE.WebGLCubeRenderTarget(this._res,{format:THREE.RGBEFormat,generateMipmaps:!0,minFilter:THREE.LinearMipmapLinearFilter,encoding:THREE.sRGBEncoding}),t=new THREE.CubeCamera(this._near,this._far,e);return t.position.copy(this.pos),t.update(ATON._renderer,ATON._rootVisibleGlobal),this._envtex=e.texture,this._prevCCtarget=e,this}getEnvTex(){return this._envtex}assignToNode(e){}}var t=e;exports.default=t;
},{}],"LryX":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;let e={init:()=>{e.evLocal={},e.evNetwork={},ATON.on=e.on,ATON.fireEvent=e.fireEvent,ATON.clearEventHandlers=e.clearEventHandlers},clearEventHandlers:t=>{e.evLocal[t]=[],e.evNetwork[t]=[]},executeHandlers:(e,t)=>{if(e)for(let o=0;o<e.length;o++){const n=e[o];n&&n(t)}},on:(t,o,n)=>{if(void 0!==o){const n=e.evLocal;void 0===n[t]&&(n[t]=[]),n[t].push(o)}void 0!==n&&ATON.VRoadcast.on(t,n)},fireEvent:(t,o,n)=>{const r=e.evLocal[t];e.executeHandlers(r,o),n&&ATON.VRoadcast.fireEvent(t,o)}};var t=e;exports.default=t;
},{}],"R8yv":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;let e={init:()=>{e.materials={},e.colors={},e._loader=new THREE.MaterialLoader,e._uSem={time:{type:"float",value:0},tint:{type:"vec4",value:new THREE.Vector4(.2,.2,1,.2)}},e.addDefaults()},getDefVertexShader:()=>"\n        varying vec3 vPositionW;\n        varying vec3 vNormalW;\n        varying vec3 vNormalV;\n\n        void main(){\n            vPositionW = vec3( vec4( position, 1.0 ) * modelMatrix);\n            vNormalW   = normalize( vec3( vec4( normal, 0.0 ) * modelMatrix ) );\n            vNormalV   = normalize( vec3( normalMatrix * normal ));\n\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }\n    ",addDefaults:()=>{e.colors.white=new THREE.Color(1,1,1),e.colors.black=new THREE.Color(0,0,0),e.colors.green=new THREE.Color(0,1,0),e.colors.yellow=new THREE.Color(1,1,0),e.colors.red=new THREE.Color(1,0,0),e.colors.blue=new THREE.Color(0,0,1),e.colors.orange=new THREE.Color(1,.5,0),e.colors.defUI=new THREE.Color(0,1,.5),e.colors.sem=new THREE.Color(0,1,.5),e.colors.darksem=new THREE.Color(0,0,.1),e.materials.fullyTransparent=new THREE.MeshBasicMaterial({transparent:!0,depthWrite:!1,opacity:0}),e.materials.defUI=new THREE.ShaderMaterial({uniforms:{color:{type:"vec3",value:e.colors.defUI},opacity:{type:"float",value:.8}},vertexShader:e.getDefVertexShader(),fragmentShader:"\n            varying vec3 vPositionW;\n\t\t    varying vec3 vNormalW;\n            varying vec3 vNormalV;\n            uniform vec3 color;\n            uniform float opacity;\n\n\t\t    void main(){\n\t\t        //vec3 viewDirectionW = normalize(cameraPosition - vPositionW);\n\n                float f;\n\t\t        //f = dot(viewDirectionW, vNormalW);\n                f = dot(vNormalV, vec3(0,0,1));\n\t\t        f = clamp(1.0 - f, 0.2, 1.0);\n\n\t\t        gl_FragColor = vec4(color.rgb, f * opacity);\n\t\t    }\n        ",transparent:!0,depthWrite:!1}),e.materials.selector=e.materials.defUI.clone(),e.materials.controllerRay=e.materials.defUI.clone(),e.materials.controllerRay.uniforms.color.value=e.colors.white,e.materials.teleportLoc=new THREE.MeshBasicMaterial({transparent:!0,opacity:1,depthWrite:!1,side:THREE.DoubleSide}),ATON.Utils.textureLoader.load(ATON.PATH_RES+"grad.png",t=>{e.materials.teleportLoc.map=t}),e.materials.measurement=new THREE.MeshBasicMaterial({color:e.colors.white,transparent:!0,depthWrite:!1,opacity:.5,depthTest:!1}),e.materials.semanticShape=new THREE.ShaderMaterial({uniforms:e._uSem,vertexShader:e.getDefVertexShader(),fragmentShader:"\n            varying vec3 vPositionW;\n\t\t    varying vec3 vNormalW;\n            varying vec3 vNormalV;\n\n            uniform float time;\n            uniform vec4 tint;\n\n\t\t    void main(){\n\t\t        //vec3 viewDirectionW = normalize(cameraPosition - vPositionW);\n\n                //float ff = dot(vNormalV, vec3(0,0,1));\n\t\t        //ff = clamp(1.0-ff, 0.0, 1.0);\n\n                float f = (1.0 * cos(time*2.0)); // - 0.5;\n                //f = cos(time + (vPositionW.y*10.0));\n                f = clamp(f, 0.0,1.0);\n\n\t\t        gl_FragColor = vec4(tint.rgb, tint.a * f);\n                //gl_FragColor = vec4(tint.rgb, ff);\n\t\t    }\n        ",transparent:!0,depthWrite:!1}),e.materials.semanticShapeHL=new THREE.MeshBasicMaterial({color:e.colors.sem,transparent:!0,depthWrite:!1,opacity:.2}),e.materials.semanticShapeEdit=new THREE.MeshBasicMaterial({color:e.colors.orange,transparent:!0,depthWrite:!1,opacity:.5}),e.semIcon=new THREE.SpriteMaterial({map:(new THREE.TextureLoader).load(ATON.PATH_RES+"sui-sem.png"),transparent:!0,opacity:1,depthTest:!1}),e.materials.lp=new THREE.ShaderMaterial({vertexShader:e.getDefVertexShader(),fragmentShader:"\n            varying vec3 vPositionW;\n\t\t    varying vec3 vNormalW;\n            varying vec3 vNormalV;\n\n\t\t    void main(){\n\t\t        vec3 viewDirectionW = normalize(cameraPosition - vPositionW);\n\n                float f;\n\t\t        //f = dot(viewDirectionW, vNormalW);\n                f = dot(vNormalV, vec3(0,0,1));\n\t\t        f = clamp(1.0 - f, 0.0, 1.0);\n\n\t\t        gl_FragColor = vec4(1.0,1.0,1.0, f);\n\t\t    }\n        ",transparent:!0,depthWrite:!1}),e.lpIcon=new THREE.SpriteMaterial({map:(new THREE.TextureLoader).load(ATON.PATH_RES+"sui-lp.png"),transparent:!0,opacity:1,depthWrite:!1}),e.semIcon.sizeAttenuation=!1,e.lpIcon.sizeAttenuation=!1},addMaterial:(t,a)=>{e.materials[t]?console.log("MatHub: material "+t+" already registered"):e.materials[t]=a},loadMaterial:(t,a)=>{e._loader.load(a,a=>{e.addMaterial(t,a)},void 0,e=>{console.log(e)})},getMaterial:t=>e.materials[t],update:()=>{e._uSem.time.value+=ATON._dt}};var t=e;exports.default=t;
},{}],"P9TA":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;let e={TSTRING_SEPARATOR:" ",init:()=>{ATON.device={},e.geomUnitSphere=new THREE.SphereGeometry(1,16,16),e.exporterGLTF=void 0,e.exporterOBJ=void 0,e._dlink=document.createElement("a"),e._dlink.style.display="none",document.body.appendChild(e._dlink),e.textureLoader=new THREE.TextureLoader},generateID:e=>(void 0===e&&(e="id"),e+"-"+Math.random().toString(36).substr(2,9)),goToURL:e=>{window.location.href=e},isConnectionSecure:()=>window.isSecureContext,profileDevice:()=>{ATON.device.isMobile=!1;ATON.device.isMobile=(()=>!(!/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)&&!/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4))))(),ATON.device.xrSupported={},ATON.device.xrSupported["immersive-vr"]=!1,ATON.device.xrSupported["immersive-ar"]=!1,"xr"in navigator&&(navigator.xr.isSessionSupported("immersive-vr").then(e=>{ATON.device.xrSupported["immersive-vr"]=!!e,console.log("WebXR VR session support: "+ATON.device.xrSupported["immersive-vr"])}),navigator.xr.isSessionSupported("immersive-ar").then(e=>{ATON.device.xrSupported["immersive-ar"]=!!e,console.log("WebXR AR session support: "+ATON.device.xrSupported["immersive-ar"])}))},isMobile:()=>ATON.device.isMobile,isVRsupported:()=>ATON.device.xrSupported["immersive-vr"],isARsupported:()=>ATON.device.xrSupported["immersive-ar"],getFileExtension:e=>e.substr(e.lastIndexOf(".")+1).toLowerCase(),removeFileExtension:e=>e.replace(/\.[^/.]+$/,""),isVideo:t=>{let r=e.getFileExtension(t);return"mp4"===r||("webm"===r||void 0)},getBaseFolder:e=>{var t=e.lastIndexOf("/");return-1!==t?e.substring(0,t+1):""},isResourceURL:e=>!!e.startsWith("http://")||!!e.startsWith("https://"),URLify:e=>{const t=e.match(/(((ftp|https?):\/\/)[\-\w@:%_\+.~#?,&\/\/=]+)/g);return t&&t.forEach(function(t){e=e.replace(t,'<a target="_blank" href="'+t+'">'+t+"</a>")}),e},resolveCollectionURL:e=>e.startsWith("http")?e:ATON.PATH_COLLECTION+e,postJSON:(e,t,r,a)=>{$.ajax({url:e,type:"POST",xhrFields:{withCredentials:!0},data:JSON.stringify(t),contentType:"application/json; charset=utf-8",dataType:"json",success:e=>{r&&r(e)}}).fail(e=>{console.log(e),a&&a()})},mergeObject:e=>{e.updateMatrixWorld(!0);const t=[];e.traverse(e=>{if(e.isMesh){const r=e.geometry;r.applyMatrix4(e.matrixWorld),t.push(r.toNonIndexed())}});const r=THREE.BufferGeometryUtils.mergeBufferGeometries(t,!1),a=THREE.BufferGeometryUtils.mergeVertices(r).center(),o=new THREE.Group,i=new THREE.Mesh(a);return o.add(i),o},setPicking:(e,t,r)=>{void 0===r&&(r=!0),e.traverse(e=>{r?e.layers.enable(t):e.layers.disable(t)})},graphPostVisitor:t=>{t.visible?console.log(t):e.setPicking(t,t.type,!1)},updateTSetsCamera:e=>{void 0===e&&(e=ATON.Nav._camera);const t=ATON._tsets.length;if(!(t<=0))for(let r=0;r<t;r++){const t=ATON._tsets[r];for(let e in t.cameras)t.deleteCamera(t.cameras[e]);t.setCamera(e),t.setResolution(e,200,200)}},loadTileSet:(t,r)=>{let a=new TILES.TilesRenderer(t);if(!a)return;a.fetchOptions.mode="cors",a.setCamera(ATON.Nav._camera),a.setResolutionFromRenderer(ATON.Nav._camera,ATON._renderer);let o=!1;a.onLoadModel=(e=>{o||(ATON._onAllReqsCompleted(),o=!0),e.traverse(e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0),e.material&&(r.userData.cMat&&(e.material=r.userData.cMat),e.material.map&&(e.material.map.minFilter=THREE.LinearMipmapLinearFilter,e.material.map.magFilter=THREE.LinearFilter))})}),a.onDisposeModel=(e=>{e.traverse(e=>{e.isMesh&&e.material.dispose()})}),r.add(a.group),e.setPicking(r,r.type,!0),ATON._tsets.push(a)},modelVisitor:(e,t)=>{if(!t)return;let r=e,a=r.type;t.traverse(e=>{e.isMesh&&(a===ATON.NTYPES.SCENE&&(e.castShadow=!0,e.receiveShadow=!0,e.geometry&&(e.geometry.computeBoundsTree(),console.log("Computed visible BVH")),null!==e.material.map&&(e.material.map.generateMipmaps=!0,e.material.map.anisotropy=ATON.device.isMobile?0:ATON._maxAnisotropy,e.material.map.minFilter=THREE.LinearMipmapLinearFilter,e.material.map.magFilter=THREE.LinearFilter)),a===ATON.NTYPES.SEM&&(e.material=ATON.MatHub.materials.semanticShape,e.geometry&&(e.geometry.computeBoundsTree(),console.log("Computed semantic BVH"))),r.userData.cMat&&(e.material=r.userData.cMat))})},registerAniMixers:(e,t)=>{let r=t.scene||t.scene[0],a=!1;if(void 0===t.animations)return;let o=new THREE.AnimationMixer(r);t.animations.forEach(e=>{o.clipAction(e).play(),a=!0}),a&&(ATON._aniMixers.push(o),void 0===e._aniMixers&&(e._aniMixers=[]),e._aniMixers.push(o))},ccExtract:e=>{if(void 0===e)return;if(void 0===e.asset)return;if(void 0===e.asset.extras)return;let t=e.asset.extras;ATON._ccModels.push(t),console.log(t)},parseTransformString:t=>{let r=new THREE.Group,a=t.split(e.TSTRING_SEPARATOR),o=a.length;return o<3?r:(r.position.set(parseFloat(a[0]),parseFloat(a[1]),parseFloat(a[2])),o<6?r:(r.rotation.set(parseFloat(a[3]),parseFloat(a[4]),parseFloat(a[5])),o<9?r:(r.scale.set(parseFloat(a[6]),parseFloat(a[7]),parseFloat(a[8])),r)))},setVectorPrecision:(e,t)=>(e.x=parseFloat(e.x.toPrecision(t)),e.y=parseFloat(e.y.toPrecision(t)),e.z=parseFloat(e.z.toPrecision(t)),e),checkAuth:e=>{$.ajax({type:"GET",url:ATON.PATH_RESTAPI+"user",xhrFields:{withCredentials:!0},dataType:"json",success:t=>{e(t)}})},getHumanReadableDistance:e=>{let t=" m";return e<.01?(t=" mm",t=(e*=1e3).toPrecision(3)+t):e<1?(t=" cm",t=(e*=100).toPrecision(3)+t):e>1e3?(t=" km",t=e.toPrecision(3)+t):t=e.toPrecision(3)+t},stripHTMLtagsFromString:e=>e=e.replace(/(<([^>]+)>)/gi,""),requestFullscreen:()=>{let e=document.documentElement;return e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen(),!0},downloadBlob:(t,r)=>{void 0!==r&&(e._dlink.href=URL.createObjectURL(t),e._dlink.download=r,e._dlink.click())},downloadText:(t,r)=>{e.downloadBlob(new Blob([t],{type:"text/plain"}),r)},downloadJSONobj:(t,r)=>{e.downloadText(JSON.stringify(t),r)},downloadArrayBuffer:(t,r)=>{e.downloadBlob(new Blob([t],{type:"application/octet-stream"}),r)},exportNode:(t,r)=>{let a=e.getFileExtension(r);if(!(a.length<1)){if("glb"===a||"gltf"===a){let o={binary:"glb"===a};void 0===e.exporterGLTF&&(e.exporterGLTF=new THREE.GLTFExporter),e.exporterGLTF.parse(t,t=>{t instanceof ArrayBuffer?e.downloadArrayBuffer(t,r):(console.log(t),e.downloadJSONobj(t,r))},o)}if("obj"===a){void 0===e.exporterOBJ&&(e.exporterOBJ=new THREE.OBJExporter);let a=e.exporterOBJ.parse(t);e.downloadText(a,r)}}},takeScreenshot:(t,r)=>{let a=new Image;console.log("Screenshot with size:"+t),ATON.Nav._camera.aspect=1,ATON.Nav._camera.updateProjectionMatrix(),ATON._renderer.setSize(t,t),ATON._renderer.render(ATON._mainRoot,ATON.Nav._camera);let o=ATON._renderer.domElement.toDataURL();return a.src=o,r&&(e._dlink.href=o.replace("image/png","image/octet-stream"),e._dlink.download=r,e._dlink.click()),ATON._onResize(),a},assignLightProbeToMesh:(e,t)=>{void 0!==e&&void 0!==t&&(t.noLP||(t.userData.LP=e))},createATONCube:t=>{let r=new THREE.BoxBufferGeometry(1,1,1),a=new THREE.MeshStandardMaterial;e.textureLoader.load(ATON.PATH_RES+"models/aton-cube.jpg",e=>{e.encoding=THREE.sRGBEncoding,a.map=e});let o=ATON.createSceneNode(t);return o.add(new THREE.Mesh(r)),o.setMaterial(a),o.enablePicking(),o},createATONCubePBR:t=>{let r=new THREE.BoxBufferGeometry(1,1,1),a=new THREE.MeshStandardMaterial;a.metalness=1,e.textureLoader.load(ATON.PATH_RES+"models/aton-cube.jpg",e=>{e.encoding=THREE.sRGBEncoding,a.map=e}),e.textureLoader.load(ATON.PATH_RES+"models/aton-cube-pbr.jpg",e=>{e.encoding=THREE.sRGBEncoding,a.metalnessMap=e,a.roughnessMap=e}),e.textureLoader.load(ATON.PATH_RES+"models/aton-cube-nrm.png",e=>{e.encoding=THREE.sRGBEncoding,a.normalMap=e});let o=ATON.createSceneNode(t);return o.add(new THREE.Mesh(r)),o.setMaterial(a),o.enablePicking(),o},createGround:(t,r,a)=>{void 0===r&&(r=1),void 0===a&&(a=1);let o=new THREE.PlaneBufferGeometry(r,a),i=new THREE.MeshStandardMaterial;void 0!==t&&e.textureLoader.load(t,e=>{e.encoding=THREE.sRGBEncoding,i.map=e});let s=ATON.createSceneNode().rotateX(.5*-Math.PI);return s.add(new THREE.Mesh(o,i)),s.enablePicking(),s}};var t=e;exports.default=t;
},{}],"qC8Z":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;let e={MODE_ADD:0,MODE_DEL:1,FLOAT_PREC:5,init:()=>{e.currID=void 0,e.currData=void 0,e._bEdit=!1,e._bLoading=!1,e._title=void 0,e._descr=void 0,e.initBaseParsers()},setEditMode:t=>{e._bEdit=t,console.log("Edit mode:"+t)},load:(t,o,i)=>(e._bLoading=!0,console.log("Loading Scene: "+o),$.getJSON(t,t=>{e.currData=t,e.currID=o,e._bLoading=!1,e.parseScene(t),i&&i(),ATON.fireEvent("SceneJSONLoaded",o)})),parseScene:t=>{if(void 0!==(t=void 0===t?e.currData:t))for(let o in t)e._jsonParsers[o]&&e._jsonParsers[o](t[o])},getJSONchildren:(e,t)=>{void 0===t&&(t=ATON.NTYPES.SCENE);let o=void 0,i=[];if(t===ATON.NTYPES.SEM&&(o=ATON.getSemanticNode(e)),t===ATON.NTYPES.SCENE&&(o=ATON.getSceneNode(e)),void 0!==o){for(let e in o.children){let t=o.children[e];void 0!==t.nid&&i.push(t.nid)}return i}},getJSONgraphEdges:e=>{void 0===e&&(e=ATON.NTYPES.SCENE);let t=ATON.snodes;e===ATON.NTYPES.SEM&&(t=ATON.semnodes),e===ATON.NTYPES.UI&&(t=ATON.uinodes);let o={};for(let i in t){let e=t[i];e&&e.parent&&e.parent.nid&&(void 0===o[e.parent.nid]&&(o[e.parent.nid]=[]),o[e.parent.nid].push(e.nid))}return o},getJSONsemanticSpheresList:t=>{let o=ATON.getSemanticNode(t);if(void 0===o)return;let i=[];for(let r in o.children){let t=o.children[r];t.type&&i.push([parseFloat(t.position.x.toPrecision(e.FLOAT_PREC)),parseFloat(t.position.y.toPrecision(e.FLOAT_PREC)),parseFloat(t.position.z.toPrecision(e.FLOAT_PREC)),parseFloat(t.scale.x.toPrecision(e.FLOAT_PREC))])}return i},getJSONsemanticConvexShapes:e=>{let t=ATON.getSemanticNode(e);if(void 0===t)return;let o=[];for(let i in t.children){let e=t.children[i];e.userData._convexPoints&&o.push(e.userData._convexPoints)}return o},initBaseParsers:()=>{e._jsonParsers={},e._jsonParsers.title=(t=>{void 0!==t&&e.setTitle(t)}),e._jsonParsers.description=(t=>{void 0!==t&&e.setDescription(t)}),e._jsonParsers.environment=(e=>{let t=e.mainpano;e.mainpano&&(t.url&&ATON.setMainPanorama(t.url),t.rotation&&ATON.setMainPanoramaRotation(t.rotation)),e.bgcolor&&ATON.setBackgroundColor(new THREE.Color(e.bgcolor[0],e.bgcolor[1],e.bgcolor[2]));let o=e.mainlight;o?(o.direction&&ATON.setMainLightDirection(new THREE.Vector3(o.direction[0],o.direction[1],o.direction[2])),ATON._dMainL?(o.color&&(ATON._dMainL.color=new THREE.Color(o.color[0],o.color[1],o.color[2])),o.intensity&&(ATON._dMainL.intensity=o.intensity),void 0!==o.shadows?ATON.toggleShadows(o.shadows):ATON.toggleShadows(!1)):ATON.toggleMainLight(!1)):ATON.toggleMainLight(!1);let i=e.lightprobes;i&&i.auto&&ATON.setAutoLP(!0),e.exposure&&ATON.setExposure(e.exposure)}),e._jsonParsers.soundscape=(e=>{void 0!==e&&e.global&&ATON.setGlobalAudio(e.global.url,e.global.loop)}),e._jsonParsers.navmode=(e=>{void 0!==e&&ATON.Nav.setNavMode(e)}),e._jsonParsers.measurements=(e=>{if(void 0!==e)for(let t in e){let o=e[t];if(o.points&&6===o.points.length){let e=new THREE.Vector3(parseFloat(o.points[0]),parseFloat(o.points[1]),parseFloat(o.points[2])),t=new THREE.Vector3(parseFloat(o.points[3]),parseFloat(o.points[4]),parseFloat(o.points[5]));ATON.SUI.addMeasurementPoint(e),ATON.SUI.addMeasurementPoint(t)}}}),e._jsonParsers.viewpoints=(e=>{if(void 0!==e)for(let t in e){let o=e[t];"home"===t?ATON.Nav.setHomePOV((new ATON.POV).setPosition(o.position[0],o.position[1],o.position[2]).setTarget(o.target[0],o.target[1],o.target[2]).setFOV(o.fov)):new ATON.POV(t).setPosition(o.position[0],o.position[1],o.position[2]).setTarget(o.target[0],o.target[1],o.target[2]).setFOV(o.fov)}}),e._jsonParsers.scenegraph=(e=>{if(void 0===e)return;let t=e.nodes,o=e.edges;for(let i in t){let e=t[i],o=ATON.getOrCreateSceneNode(i).removeChildren(),r=e.transform;r&&(r.position&&o.setPosition(r.position[0],r.position[1],r.position[2]),r.rotation&&o.setRotation(r.rotation[0],r.rotation[1],r.rotation[2]),r.scale&&o.setScale(r.scale[0],r.scale[1],r.scale[2]),r.list&&Array.isArray(r.list));let s=e.urls;s&&(Array.isArray(s)?s.forEach(e=>{ATON.createSceneNode().load(e).attachTo(o)}):o.load(s)),e.shadowcast&&o.setShadowCast(e.shadowcast),e.shadowreceive&&o.setShadowCast(e.shadowreceive),e.toYup&&o.setYup(),e.keywords&&(o.kwords=e.keywords)}for(let i in o){let e=o[i],t=ATON.getSceneNode(i);if(void 0!==t)for(let o in e){let i=e[o],r=ATON.getSceneNode(i);void 0!==r&&r.attachTo(t)}}for(let i in t){let e=t[i],o=ATON.getSceneNode(i);if(void 0!==o&&(void 0!==e.show&&(e.show?(o.show(),console.log("show "+i)):(o.hide(),console.log("hide "+i))),e.material)){let t=new THREE.MeshStandardMaterial(e.material);o.setMaterial(t)}}}),e._jsonParsers.semanticgraph=(e=>{if(void 0===e)return;let t=e.nodes,o=e.edges;for(let i in t){let e=t[i],o=ATON.getOrCreateSemanticNode(i).removeChildren(),r=e.urls;r&&(Array.isArray(r)?r.forEach(e=>{ATON.createSemanticNode().load(e).attachTo(o)}):o.load(r)),e.toYup&&o.setYup(),e.description&&o.setDescription(e.description),e.audio&&o.setAudio(e.audio),e.keywords&&(o.kwords=e.keywords);let s=e.spheres;if(Array.isArray(s))for(let t in s){let e=s[t],o=new THREE.Vector3(parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2]));ATON.SemFactory.createSphere(i,o,parseFloat(e[3]))}let a=e.convexshapes;if(Array.isArray(a))for(let t in a){let e=a[t],o=[];for(let t=0;t<e.length;t+=3){let i=new THREE.Vector3(e[t],e[t+1],e[t+2]);o.push(i)}ATON.SemFactory.createConvexShape(i,o)}}for(let i in o){let e=o[i],t=ATON.getSemanticNode(i);if(void 0!==t)for(let o in e){let i=e[o],r=ATON.getSemanticNode(i);void 0!==r&&r.attachTo(t)}}for(let i in t){let e=t[i],o=ATON.getSemanticNode(i);if(void 0!==o&&(void 0!==e.show&&(e.show?(o.show(),console.log("show "+i)):(o.hide(),console.log("hide "+i))),e.nopicking&&o.disablePicking(),e.material)){let t=new THREE.MeshStandardMaterial(e.material);o.setMaterial(t)}}})},addSceneParser:(t,o)=>{e._jsonParsers[t]=o},sendEdit:(t,o,i)=>{if(e._bLoading||!e._bEdit)return;if(void 0===t)return;void 0===o&&(o=e.MODE_ADD);let r=e.currID,s={};s.sid=r,s.data=t,s.mode=o===e.MODE_DEL?"DEL":"ADD";let a=JSON.stringify(s);$.ajax({url:ATON.PATH_RESTAPI+"edit/scene",type:"POST",data:a,contentType:"application/json; charset=utf-8",dataType:"json",success:t=>{t&&(e.currData=t),i&&i()}})},setTitle:t=>{e._title=t},getTitle:()=>e._title,setDescription:t=>{e._descr=t},getDescription:()=>e._descr};var t=e;exports.default=t;
},{}],"mYhb":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;let e={init:()=>{e._listener=new THREE.AudioListener,e._loader=new THREE.AudioLoader},playOnceGlobally:l=>{l=ATON.Utils.resolveCollectionURL(l);let o=new THREE.Audio(ATON.AudioHub._listener);e._loader.load(l,e=>{o.setBuffer(e),o.play()})}};var l=e;exports.default=l;
},{}],"nomA":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;const e=function(e){return(1-Math.cos(e*Math.PI))/2};let t={STD_FOV:50,STD_NEAR:.01,STD_FAR:800,FP_EPS:.01,STD_POV_TRANS_DURATION:2,MODE_ORBIT:0,MODE_FP:1,MODE_DEVORI:2,init:()=>{t._mode=void 0,t.POVtransitionDuration=t.STD_POV_TRANS_DURATION,t._rotSpeedOrbit=.4,t._rotSpeedFP=-.2,t._inertia=.08,t._bControl=!0,t._bInteracting=!1,t._prevMode=void 0,t.setOrbitControl(),t._currPOV=(new ATON.POV).setFOV(ATON.Nav.STD_FOV),t._fromPOV=new ATON.POV,t._reqPOV=new ATON.POV,t.homePOV=void 0,t._tPOVcall=-1,t._tPOVprogress=0,t.povlist={},t._vDir=new THREE.Vector3(1,0,0),t._qOri=new THREE.Quaternion,t._motionAmt=0,t._motionDir=new THREE.Vector3(0,1,0),t._bValidLocomotion=!1},getCurrentEyeLocation:()=>t._currPOV.pos,getCurrentDirection:()=>t._vDir,copyCurrentPOV:()=>{let e=new ATON.POV;return e.pos.copy(t._currPOV.pos),e.target.copy(t._currPOV.target),e.fov=t._currPOV.fov,e},addPOV:(e,t)=>{if(void 0!==e)return e.as(t),e},isTransitioning:()=>t._tPOVcall>=0,currentQueryValidForLocomotion:()=>t._bValidLocomotion,locomotionValidator:()=>{if(void 0===ATON._queryDataScene)return void(t._bValidLocomotion=!1);ATON._queryDataScene.p;ATON._queryDataScene.n.y<=.7?t._bValidLocomotion=!1:t._bValidLocomotion=!0},setUserControl:e=>{void 0!==e&&e!==t._bControl&&(t._bControl=e,void 0!==t._controls&&(t._controls.enabled=e),t._cOrbit&&(t._cOrbit.enabled=e),t._cFirstPerson&&(t._cFirstPerson.enabled=e),console.log("Nav controls: "+t._bControl))},toggleUserControl:()=>{t.setUserControl(!t._bControl)},isUserControlEnabled:()=>t._bControl,isOrbit:()=>t._mode===t.MODE_ORBIT,isFirstPerson:()=>t._mode===t.MODE_FP,isDevOri:()=>t._mode===t.MODE_DEVORI,setNavMode:e=>{void 0!==e&&(e===t.MODE_ORBIT&&t.setOrbitControl(),e===t.MODE_FP&&t.setFirstPersonControl(),e===t.MODE_DEVORI&&t.setDeviceOrientationControl())},restorePreviousNavMode:()=>{void 0===t._prevMode&&t.setOrbitControl(),t.setNavMode(t._prevMode)},setOrbitControl:()=>{if(!ATON.XR.isPresenting()){if(t._prevMode=t._mode,t._mode=t.MODE_ORBIT,t._bInteracting=!1,void 0===t._cOrbit){t._camOrbit=new THREE.PerspectiveCamera(t.STD_FOV,window.innerWidth/window.innerHeight,t.STD_NEAR,t.STD_FAR),t._camOrbit.layers.enableAll(),t._cOrbit=new THREE.OrbitControls(t._camOrbit,ATON._renderer.domElement);let e=t._cOrbit;e.rotateSpeed=t._rotSpeedOrbit,e.enablePan=!0,t._inertia>0&&(e.enableDamping=!0,e.dampingFactor=t._inertia),e.screenSpacePanning=!0,e.enableZoom=!0,e.minDistance=.03,e.maxDistance=100,t._bControl||(e.enabled=!1),e.addEventListener("start",()=>{t._bInteracting=!0}),e.addEventListener("end",()=>{t._bInteracting=!1})}t._controls=t._cOrbit,t._camera=t._camOrbit,ATON.AudioHub._listener&&t._camera.children.length<1&&t._camera.add(ATON.AudioHub._listener),ATON.Utils.updateTSetsCamera(),t._controls.update(),t._currPOV&&t.syncCurrCamera(),ATON._onResize(),ATON.fireEvent("NavMode",t._mode)}},setFirstPersonControl:()=>{if(!ATON.XR.isPresenting()){if(t._prevMode=t._mode,ATON.SUI.getSelectorRadius()>.5&&ATON.SUI.setSelectorRadius(.5),t._mode=t.MODE_FP,t._bInteracting=!1,void 0===t._cFirstPerson){t._camFP=new THREE.PerspectiveCamera(t.STD_FOV,window.innerWidth/window.innerHeight,t.STD_NEAR,t.STD_FAR),t._camFP.layers.enableAll(),t._cFirstPerson=new THREE.OrbitControls(t._camFP,ATON._renderer.domElement);let e=t._cFirstPerson;e.enableZoom=!1,e.enablePan=!1,e.rotateSpeed=t._rotSpeedFP,t._inertia>0&&(e.enableDamping=!0,e.dampingFactor=t._inertia),e.target.copy(t._camera.position),e.minDistance=.01,e.maxDistance=.01,t._bControl||(e.enabled=!1)}t._controls=t._cFirstPerson,t._camera=t._camFP,ATON.AudioHub._listener&&t._camera.children.length<1&&t._camera.add(ATON.AudioHub._listener),ATON.Utils.updateTSetsCamera(),t._controls.update(),t._currPOV&&t.syncCurrCamera(),ATON._onResize(),ATON.fireEvent("NavMode",t._mode)}},setDeviceOrientationControl:()=>{ATON.Utils.isMobile()&&(t._prevMode=t._mode,t._mode=t.MODE_DEVORI,t._bInteracting=!1,ATON._screenPointerCoords.set(0,0),void 0===t._cDevOri&&(t._camDevOri=new THREE.PerspectiveCamera(t.STD_FOV,window.innerWidth/window.innerHeight,t.STD_NEAR,t.STD_FAR),t._camDevOri.layers.enableAll(),t._cDevOri=new THREE.DeviceOrientationControls(t._camDevOri,ATON._renderer.domElement),t._cDevOri.alphaOffset=0),t._controls=t._cDevOri,t._camera=t._camDevOri,ATON.AudioHub._listener&&t._camera.children.length<1&&t._camera.add(ATON.AudioHub._listener),ATON.Utils.updateTSetsCamera(),t._controls.update(),t._currPOV&&t.syncCurrCamera(),ATON._onResize(),ATON.fireEvent("NavMode",t._mode))},setMotionAmount:e=>{t._motionAmt=e},setMotionDirection:e=>{t._motionDir.copy(e)},stop:()=>{t._motionAmt=0},setFOV:e=>{if(ATON.XR.isPresenting())return;t._currPOV.fov=e;let r=t._camera;r.fov=e,r.updateProjectionMatrix()},getFOV:()=>t._currPOV.fov,syncCurrPOV:()=>{if(ATON.XR.isPresenting())return ATON.XR._cam=ATON._renderer.xr.getCamera(t._camera),ATON.XR._cam.getWorldPosition(t._currPOV.pos),ATON.XR._cam.getWorldQuaternion(t._qOri),void ATON.XR._cam.getWorldDirection(t._vDir);const e=t._controls,r=t._camera;if(r.getWorldDirection(t._vDir),r.getWorldQuaternion(t._qOri),t._mode!==t.MODE_DEVORI){if(t._mode===t.MODE_FP)return t._currPOV.pos.copy(e.target),t._currPOV.target.x=t._currPOV.pos.x+t._vDir.x,t._currPOV.target.y=t._currPOV.pos.y+t._vDir.y,void(t._currPOV.target.z=t._currPOV.pos.z+t._vDir.z);t._currPOV.pos.copy(r.position),t._currPOV.target.copy(e.target)}else t._currPOV.pos.copy(r.position)},handlePOV:()=>{ATON.XR.isPresenting()?t.handleXRtransition():t.handlePOVtransition()},handleMotion:()=>{if(!t.isTransitioning()&&0!=t._motionAmt){ATON.XR.controller0&&ATON.XR.controller0.visible?(ATON.XR.controller0.getWorldDirection(t._motionDir),t._motionDir.negate()):t._motionDir.copy(t._vDir);let e=t._motionDir.clone();e.multiplyScalar(t._motionAmt*ATON._dt),t._currPOV.pos.add(e),t._currPOV.target.add(e)}},handlePOVtransition:()=>{if(!(t._tPOVcall<0)){if(t.POVtransitionDuration<=0?t._tPOVprogress=1:t._tPOVprogress=(ATON._clock.elapsedTime-t._tPOVcall)/t.POVtransitionDuration,t._tPOVprogress>=1)return t._tPOVcall=-1,t._currPOV.pos.copy(t._reqPOV.pos),t._currPOV.target.copy(t._reqPOV.target),t._currPOV.fov=t._reqPOV.fov,void ATON.fireEvent("POVTransitionCompleted",t._reqPOV.id);t._tPOVprogress=e(t._tPOVprogress),t._currPOV.pos.lerpVectors(t._fromPOV.pos,t._reqPOV.pos,t._tPOVprogress),t._currPOV.target.lerpVectors(t._fromPOV.target,t._reqPOV.target,t._tPOVprogress),t._fromPOV.fov&&t._reqPOV.fov&&(t._currPOV.fov=THREE.MathUtils.lerp(t._fromPOV.fov,t._reqPOV.fov,t._tPOVprogress),t._camera.fov=t._currPOV.fov,t._camera.updateProjectionMatrix())}},handleXRtransition:()=>{if(!(t._tPOVcall<0)){if(t.POVtransitionDuration<=0?t._tPOVprogress=1:t._tPOVprogress=(ATON._clock.elapsedTime-t._tPOVcall)/t.POVtransitionDuration,t._tPOVprogress>=1)return t._tPOVcall=-1,ATON.XR._currPos.copy(ATON.XR._reqPos),console.log("XR height"+ATON.XR._currPos.y),console.log("HMD height"+t._currPOV.pos.y),void ATON.fireEvent("POVTransitionCompleted",t._reqPOV.id);ATON.XR._currPos.lerpVectors(ATON.XR._fromPos,ATON.XR._reqPos,t._tPOVprogress)}},syncCurrCamera:()=>{if(ATON.XR.isPresenting())return;let e=t._controls,r=t._camera,o=t._currPOV.pos,i=t._currPOV.target;t._mode!==t.MODE_DEVORI?(t._vDir.subVectors(i,o),t._vDir.normalize(),t._mode===t.MODE_FP?(e.target.copy(o),r.position.x=e.target.x-t._vDir.x*t.FP_EPS,r.position.y=e.target.y-t._vDir.y*t.FP_EPS,r.position.z=e.target.z-t._vDir.z*t.FP_EPS):(r.position.copy(o),e.target.copy(i))):r.position.copy(o)},update:()=>{t.syncCurrPOV(),t.handlePOV(),t.syncCurrCamera()},requestPOV:(e,r)=>{ATON._tPOVcall>=0||void 0!==e&&(ATON.fireEvent("POVTransitionRequested",e.id),void 0!==r&&(t.POVtransitionDuration=r),t._tPOVcall=ATON._clock.elapsedTime,ATON.XR.isPresenting()?(t._reqPOV.pos.copy(e.pos?e.pos:t._currPOV.pos),t._fromPOV.pos.copy(t._currPOV.pos),ATON.XR._reqPos.copy(e.pos?e.pos:t._currPOV.pos),ATON.XR._fromPos.copy(ATON.XR._currPos)):(t._reqPOV.pos.copy(e.pos?e.pos:t._currPOV.pos),t._reqPOV.target.copy(e.target?e.target:t._currPOV.target),t._reqPOV.fov=e.fov?e.fov:t._currPOV.fov,t._fromPOV.pos.copy(t._currPOV.pos),t._fromPOV.target.copy(t._currPOV.target),t._fromPOV.fov=t._currPOV.fov))},requestPOVbyBound:(e,r)=>{if(void 0===e)return;let o=new THREE.Vector3,i=3*e.radius;o.x=e.center.x-i*t._vDir.x,o.y=e.center.y-i*t._vDir.y,o.z=e.center.z-i*t._vDir.z;let n=(new ATON.POV).setPosition(o).setTarget(e.center);t.requestPOV(n,r)},requestPOVbyNode:(e,r)=>{if(void 0===e)return;let o=e.getBound();t.requestPOVbyBound(o,r)},requestRetarget:(e,r,o)=>{let i=new THREE.Vector3;if(void 0===r)i.lerpVectors(e,t._currPOV.pos,.8);else{let o=e.distanceTo(t._currPOV.pos);o*=.5,i.x=e.x+r.x*o,i.y=e.y+r.y*o,i.z=e.z+r.z*o}let n=(new ATON.POV).setPosition(i).setTarget(e).setFOV(t._currPOV.fov);console.log(n),t.requestPOV(n,o)},computeDefaultHome:e=>{void 0===e&&(e=new THREE.Vector3(1,.7,1));let r=ATON.getRootScene().getBound(),o=new THREE.Vector3(r.center.x+r.radius*e.x*1.5,r.center.y+r.radius*e.y*1.5,r.center.z+r.radius*e.z*1.5);t.homePOV=(new ATON.POV).setPosition(o).setTarget(r.center)},setHomePOV:e=>{t.homePOV=e},computeAndRequestDefaultHome:(e,r)=>{t.computeDefaultHome(r),t.requestPOV(t.homePOV,e)},requestHome:e=>{t.requestPOV(t.homePOV,e)},setAndRequestHomePOV:(e,r)=>{t.setHomePOV(e),t.requestPOV(e,r)},DeviceOrientationControls:function(e){let t=this;this.object=e,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0,this.alphaOffset=0,this.absolute=!1,this.alphaOffsetDevice=void 0,this.alphaOffsetScreen=void 0;let r=function(e){t.absolute||(t.deviceOrientation=e)},o=function(e){t.deviceOrientation=e,t.absolute=!0},i=function(){t.screenOrientation=window.orientation||0},n=function(){let e=new THREE.Vector3(0,0,1),t=new THREE.Euler,r=new THREE.Quaternion,o=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5));return function(i,n,a,s,_){t.set(a,n,-s,"YXZ"),i.setFromEuler(t),i.multiply(o),i.multiply(r.setFromAxisAngle(e,-_))}}();this.connect=function(){i(),window.addEventListener("orientationchange",i,!1),window.addEventListener("deviceorientation",r,!1),window.addEventListener("deviceorientationabsolute",o,!1),t.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",i,!1),window.removeEventListener("deviceorientation",r,!1),window.removeEventListener("deviceorientationabsolute",o,!1),t.enabled=!1},this.update=function(){if(!1===t.enabled)return;let e;if(e=t.deviceOrientation){let r=this.getDirection()?THREE.Math.degToRad(this.getDirection())+t.alphaOffset:0,o=e.beta?THREE.Math.degToRad(e.beta):0,i=e.gamma?THREE.Math.degToRad(e.gamma):0,a=t.screenOrientation?THREE.Math.degToRad(t.screenOrientation):0;n(t.object.quaternion,r,o,i,a)}},this.dispose=(()=>{t.disconnect()}),this.iOSOrientationPermission=(()=>{"function"==typeof DeviceOrientationEvent.requestPermission&&DeviceOrientationEvent.requestPermission().then(e=>{console.log(e)}).catch(console.error)}),this.getDirection=(()=>void 0!==t.deviceOrientation.webkitCompassHeading?t.deviceOrientation.webkitCompassHeading:t.deviceOrientation.alpha),this.getDirectionMap=(()=>void 0!==t.deviceOrientation.webkitCompassHeading?360-t.deviceOrientation.webkitCompassHeading:t.deviceOrientation.alpha),this.connect()}};var r=t;exports.default=r;
},{}],"jROx":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;let e={STD_TELEP_DURATION:.03,HAND_R:0,HAND_L:1,MOBILE_DENSITY_F:.5,init:()=>{ATON._renderer.xr.enabled=!0,ATON._renderer.xr.setReferenceSpaceType("local"),ATON.device.isMobile?ATON._renderer.xr.setFramebufferScaleFactor(ATON._stdpxd*e.MOBILE_DENSITY_F):ATON._renderer.xr.setFramebufferScaleFactor(ATON._stdpxd),e._bPresenting=!1,e.currSession=null,e._sessionType="immersive-vr",e.rig=new THREE.Group,e.rig.add(ATON.Nav._camera),ATON._rootUI.add(e.rig),e._cam=void 0,e._currPos=e.rig.position,e._fromPos=new THREE.Vector3,e._reqPos=new THREE.Vector3,e.gControllers=void 0,e.controller0=void 0,e.controller1=void 0,e.controller0pos=new THREE.Vector3,e.controller1pos=new THREE.Vector3,e.controller0dir=new THREE.Vector3,e.controller1dir=new THREE.Vector3,e._lastPosR=void 0,e._lastPosL=void 0,e._pointerLineGeom=void 0,e._pointerLineMesh=void 0,e.gpad0=void 0,e.gpad1=void 0,e._urlHand=ATON.PATH_RES+"models/hand/hand.glb",ATON.on("XRselectStart",r=>{r===e.HAND_R&&ATON._stdActivation()}),ATON.on("XRselectEnd",e=>{}),ATON.on("XRsqueezeStart",e=>{console.log("Squeeze "+e)}),ATON.on("VRC_IDassigned",e=>{let r=ATON.getUINode("Rhand"),o=ATON.getUINode("Lhand"),t=ATON.MatHub.materials.avatars,n=t[e%t.length];o&&o.setMaterial(n),r&&r.setMaterial(n)})},setSessionType:r=>{void 0!==r&&(e._sessionType=r,console.log("Session type: "+r))},isPresenting:()=>e._bPresenting,teleportOnQueriedPoint:()=>{if(!ATON.Nav.currentQueryValidForLocomotion())return!1;const r=ATON._queryDataScene.p;return ATON.Nav.requestPOV((new ATON.POV).setPosition(r.x,r.y+ATON.userHeight,r.z),e.STD_TELEP_DURATION),!0},setupQueryRay:r=>{void 0!==r&&(e.controller0?r.set(e.controller0pos,e.controller0dir):r.set(ATON.Nav.getCurrentEyeLocation(),ATON.Nav.getCurrentDirection()))},setRefSpaceLocation:r=>{e.rig.position.copy(r)},_setupControllerR:(r,o)=>{e.controller0||(e.controller0=r,console.log("R controller"),r.addEventListener("selectstart",()=>{ATON.fireEvent("XRselectStart",e.HAND_R)}),r.addEventListener("selectend",()=>{ATON.fireEvent("XRselectEnd",e.HAND_R)}),r.addEventListener("squeezestart",()=>{ATON.fireEvent("XRsqueezeStart",e.HAND_R)}),r.addEventListener("squeezeend",()=>{ATON.fireEvent("XRsqueezeEnd",e.HAND_R)}),e.setupControllerUI(e.HAND_R,o),ATON.fireEvent("XRcontrollerConnected",e.HAND_R))},_setupControllerL:(r,o)=>{e.controller1||(e.controller1=r,console.log("L controller"),r.addEventListener("selectstart",()=>{ATON.fireEvent("XRselectStart",e.HAND_L)}),r.addEventListener("selectend",()=>{ATON.fireEvent("XRselectEnd",e.HAND_L)}),r.addEventListener("squeezestart",()=>{ATON.fireEvent("XRsqueezeStart",e.HAND_L)}),r.addEventListener("squeezeend",()=>{ATON.fireEvent("XRsqueezeEnd",e.HAND_L)}),e.setupControllerUI(e.HAND_L,o),ATON.fireEvent("XRcontrollerConnected",e.HAND_L))},onSessionStarted:r=>{e.currSession||(r.addEventListener("end",e.onSessionEnded),console.log(e._sessionType+" session started."),ATON.MediaRec.stopMediaStreaming(),ATON._renderer.xr.setSession(r).then(()=>{e.currSession=r,console.log(e.currSession),"immersive-ar"===e._sessionType&&(ATON._mainRoot.background=null,ATON._mMainPano&&(ATON._mMainPano.visible=!1));for(let r=0;r<2;r++){const o=ATON._renderer.xr.getController(r);void 0===o||o.userData.bXRconfig||(o.visible=!1,o.userData.bXRconfig=!0,o.addEventListener("connected",r=>{let t=r.data.handedness;console.log("Hand "+t),"left"===t?e._setupControllerL(o,!0):"right"===t?e._setupControllerR(o,!0):(o.addEventListener("selectstart",()=>{ATON.fireEvent("XRselectStart",e.HAND_R),console.log("Head-aligned select")}),o.addEventListener("selectend",()=>{ATON.fireEvent("XRselectEnd",e.HAND_R)}),ATON.fireEvent("XRcontrollerConnected",e.HAND_R))}))}e.rig.add(ATON.Nav._camera),e.setRefSpaceLocation(ATON.Nav._currPOV.pos),console.log(ATON.Nav._currPOV.pos),e._bPresenting=!0,console.log("XR now presenting"),ATON.fireEvent("XRmode",!0),ATON.SUI.getSelectorRadius()>.5&&ATON.SUI.setSelectorRadius(.5);let o=ATON._renderer.xr.getCamera();ATON.Utils.updateTSetsCamera(o),setTimeout(()=>{ATON.SUI.getSelectorRadius()>.5&&ATON.SUI.setSelectorRadius(.5)},2e3)}))},onSessionEnded:()=>{e.currSession.removeEventListener("end",e.onSessionEnded),e.currSession=null,e._bPresenting=!1,e.setRefSpaceLocation(new THREE.Vector3(0,0,0)),ATON.fireEvent("XRmode",!1),ATON.MediaRec.stopMediaStreaming(),ATON.Nav.requestHome(),ATON.Utils.updateTSetsCamera(),console.log("Quit XR")},toggle:()=>{if(ATON.device.xrSupported[e._sessionType])if(null===e.currSession){let r={optionalFeatures:[]};navigator.xr.requestSession(e._sessionType,r).then(e.onSessionStarted)}else e.currSession.end()},setupControllerUI:(r,o)=>{let t=void 0,n=void 0;if(void 0===e.gControllers&&(e.gControllers=ATON.createUINode(),e.gControllers.disablePicking(),e.rig.add(e.gControllers)),r===e.HAND_L?(e.gControllers.add(e.controller1),o&&(n=ATON.createUINode("Lhand").load(e._urlHand).setMaterial(ATON.MatHub.materials.controllerRay).setScale(-1,1,1),e.controller1.add(n))):(e.gControllers.add(e.controller0),o&&(e._pointerLineGeom=new THREE.CylinderBufferGeometry(.003,.003,1,4),e._pointerLineGeom.rotateX(-Math.PI/2),e._pointerLineGeom.translate(0,0,-.5),e._pointerLineMesh=new THREE.Mesh(e._pointerLineGeom,ATON.MatHub.materials.controllerRay),e.controller0.add(e._pointerLineMesh),e._pointerLineMesh.visible=!1,t=ATON.createUINode("Rhand").load(e._urlHand).setMaterial(ATON.MatHub.materials.controllerRay),e.controller0.add(t))),void 0!==ATON.VRoadcast.uid&&o){let o=ATON.MatHub.materials.avatars,l=o[ATON.VRoadcast.uid%o.length];r===e.HAND_L?n.setMaterial(l):t.setMaterial(l)}},switchHands:()=>{let r=e.controller1;e.controller1=e.controller0,e.controller0=r;for(let o in e.controller0.children)e.controller0.remove(e.controller0.children[o]);for(let o in e.controller1.children)e.controller1.remove(e.controller1.children[o]);e.gControllers.removeChildren(),e.setupControllerUI(e.HAND_L),e.setupControllerUI(e.HAND_R),console.log("VR controllers switched")},getControllerSpace:r=>{1===r?e.getControllerGrip(1):e.getControllerGrip(0)},getControllerWorldLocation:r=>1===r?e.controller1pos:e.controller0pos,getControllerWorldDirection:r=>1===r?e.controller1dir:e.controller0dir,_deltaMotionController:r=>{if(r===e.HAND_L&&void 0===e._lastPosL)return;if(r===e.HAND_R&&void 0===e._lastPosR)return;let o=r===e.HAND_L?e.controller1pos:e.controller0pos,t=r===e.HAND_L?e._lastPosL:e._lastPosR;THREE.Vector3(o.x-t.x,o.y-t.y,o.z-t.z).lengthSq();r===e.HAND_L?e._lastPosL=o:e._lastPosR=o},update:()=>{e.controller0&&e.controller0.visible&&(e.controller0.getWorldPosition(e.controller0pos),e.controller0.getWorldDirection(e.controller0dir),e.controller0dir.negate()),e.controller1&&e.controller1.visible&&(e.controller1.getWorldPosition(e.controller1pos),e.controller1.getWorldDirection(e.controller1dir),e.controller1dir.negate())}};var r=e;exports.default=r;
},{}],"fWYX":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=e(require("./ATON.node.js"));function e(t){return t&&t.__esModule?t:{default:t}}class i extends t.default{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(t,ATON.NTYPES.UI),this.baseColor=ATON.MatHub.colors.black,this.switchColor=ATON.MatHub.colors.green,this.baseOpacity=.5,this.hoverOpacity=.8,this._bSwitched=!1,this.container=new ThreeMeshUI.Block({width:.1*e,height:.1,padding:.01,borderRadius:.02,backgroundColor:this.baseColor,backgroundOpacity:this.baseOpacity,fontFamily:ATON.SUI.PATH_FONT_JSON,fontTexture:ATON.SUI.PATH_FONT_TEX,justifyContent:"center",alignContent:"center"}),this.add(this.container),this.uiText=new ThreeMeshUI.Text({content:"",fontSize:.02*i,fontColor:ATON.MatHub.colors.white}),this.container.add(this.uiText);let s=.9*ATON.SUI.STD_BTN_SIZE*e,r=.9*ATON.SUI.STD_BTN_SIZE;this._trigger=new THREE.Mesh(new THREE.PlaneGeometry(s,r,2),ATON.MatHub.materials.fullyTransparent),this._trigger.position.set(0,0,.002),this.add(this._trigger),this.onHover=(()=>{this.container.set({backgroundOpacity:this.hoverOpacity})}),this.onLeave=(()=>{this.container.set({backgroundOpacity:this.baseOpacity})}),this.enablePicking()}setBaseColor(t){return this.baseColor=t,this._bSwitched||this.container.set({backgroundColor:this.baseColor}),this}setSwitchColor(t){return this.switchColor=t,this._bSwitched&&this.container.set({backgroundColor:this.switchColor}),this}setBackgroundOpacity(t){return this.container.set({backgroundOpacity:t}),this.baseOpacity=t,this}setText(t){return this.uiText.set({content:t}),this}switch(t){return this._bSwitched=t,t?this.container.set({backgroundColor:this.switchColor}):this.container.set({backgroundColor:this.baseColor}),this}setIcon(t,e){return ATON.Utils.textureLoader.load(t,t=>{this._trigger.material=new THREE.MeshStandardMaterial({map:t,transparent:!0,depthWrite:!1}),e&&(this.setBackgroundOpacity(0),this.hoverOpacity=0),this.uiText.position.set(0,-.035,0)}),this}}var s=i;exports.default=s;
},{"./ATON.node.js":"XTSP"}],"iqtl":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=e(require("./ATON.node.js"));function e(t){return t&&t.__esModule?t:{default:t}}class o extends t.default{constructor(t){super(t,ATON.NTYPES.UI),this.baseColor=ATON.MatHub.colors.black,this.container=new ThreeMeshUI.Block({width:.2,height:.05,padding:.001,borderRadius:.01,backgroundColor:this.baseColor,backgroundOpacity:.5,fontFamily:ATON.SUI.PATH_FONT_JSON,fontTexture:ATON.SUI.PATH_FONT_TEX,justifyContent:"center",alignContent:"center"}),this.container.position.z=.05,this.add(this.container),this.uiText=new ThreeMeshUI.Text({content:"Label",fontSize:.03,fontColor:ATON.MatHub.colors.white}),this.container.add(this.uiText)}setBaseColor(t){return this.baseColor=t,this.container.set({backgroundColor:this.baseColor}),this}setTextColor(t){return this.uiText.set({fontColor:t}),this}setText(t){return this.uiText.set({content:t}),this}}var r=o;exports.default=r;
},{"./ATON.node.js":"XTSP"}],"xSlA":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=t(require("./ATON.sui.button.js")),o=t(require("./ATON.sui.label.js"));function t(e){return e&&e.__esModule?e:{default:e}}let i={STD_BTN_SIZE:.1};i.Button=e.default,i.Label=o.default,i.init=(()=>{i.mainSelector=ATON.createUINode(),i._mSelectorSphere=new THREE.Mesh(ATON.Utils.geomUnitSphere,ATON.MatHub.getMaterial("selector")),i._mSelectorSphere.renderOrder=100,i.mainSelector.add(i._mSelectorSphere),i.mainSelector.disablePicking(),i.setSelectorRadius(.05),i.mainSelector.visible=!1,ATON._rootUI.add(i.mainSelector),i.fpTeleport=ATON.createUINode();let e=new THREE.CylinderBufferGeometry(.4,.4,.9,32,1,!0),o=new THREE.Mesh(e,ATON.MatHub.getMaterial("teleportLoc"));o.renderOrder=100,i.fpTeleport.add(o),i.fpTeleport.disablePicking(),i.fpTeleport.visible=!1,ATON._rootUI.add(i.fpTeleport),i.PATH_FONT_JSON=ATON.PATH_RES+"fonts/custom-msdf.json",i.PATH_FONT_TEX=ATON.PATH_RES+"fonts/custom.png",i.gMeasures=ATON.createUINode(),i._prevMPoint=void 0,i._measLabels=[],ATON._rootUI.add(i.gMeasures);let t=(new THREE.BufferGeometry).setFromPoints([new THREE.Vector3,new THREE.Vector3]);i._measLine=new THREE.Line(t,ATON.MatHub.getMaterial("measurement")),i._measLine.visible=!1,ATON._rootUI.add(i._measLine),i.gPoints=ATON.createUINode(),ATON._rootUI.add(i.gPoints),i.buildInfoNode(),i.bShowInfo=!0,i._labelScale=ATON.Utils.isMobile()?50:60,i._labelScaleVR=2,ATON.on("SemanticNodeHover",e=>{i.setInfoNodeText(e),i.gSemIcons&&i.gSemIcons.hide()}),ATON.on("SemanticNodeLeave",e=>{i.gSemIcons&&i.gSemIcons.show()}),i._sync=0}),i.enableLPIcons=(()=>{i.gLPIcons=ATON.createUINode(),i.gLPIcons.disablePicking(),ATON._rootUI.add(i.gLPIcons)}),i.enableSemIcons=(()=>{i.gSemIcons=ATON.createUINode(),i.gSemIcons.disablePicking(),ATON._rootUI.add(i.gSemIcons)}),i.setSelectorRadius=(e=>{i._selectorRad=e,i.mainSelector.scale.set(e,e,e)}),i.getSelectorRadius=(()=>i._selectorRad),i.setSelectorModel=((e,o)=>{void 0!==e&&(i.mainSelector.removeChildren(),i.mainSelector.load(e).disablePicking(),o&&i.mainSelector.setMaterial(ATON.MatHub.getMaterial("selector")))}),i.setSelectorColor=((e,o)=>{ATON.MatHub.materials.selector.uniforms.color.value=e,void 0!==o&&(ATON.MatHub.materials.selector.uniforms.opacity.value=o)}),i.addSemIcon=((e,o)=>{if(void 0===i.gSemIcons)return;let t=(new THREE.Box3).setFromObject(o),a=new THREE.Sphere;t.getBoundingSphere(a);let n=new THREE.Sprite(ATON.MatHub.semIcon);n.position.copy(a.center);n.scale.set(.035,.035,1),n.name=e,i.gSemIcons.add(n)}),i.addLPIcon=(e=>{if(void 0===i.gLPIcons)return;let o=e._near,t=new THREE.Sprite(ATON.MatHub.lpIcon);t.position.copy(e.pos),t.scale.set(.1,.1,.1);let a=new THREE.Mesh(ATON.Utils.geomUnitSphere,ATON.MatHub.materials.lp);a.scale.set(o,o,o),a.position.copy(e.pos),i.gLPIcons.add(t),i.gLPIcons.add(a)}),i.setSemIconsOpacity=(e=>{ATON.MatHub.semIcon.opacity=void 0===e?1:e}),i.buildInfoNode=(()=>{i.infoNode=ATON.createUINode(),i.infoNode.attachToRoot(),i.infoContainer=new ThreeMeshUI.Block({width:.15,height:.05,padding:.01,borderRadius:.02,fontFamily:i.PATH_FONT_JSON,fontTexture:i.PATH_FONT_TEX,alignContent:"center",justifyContent:"center"}),i.infoNode.add(i.infoContainer),i.infoNodeText=new ThreeMeshUI.Text({content:"Info",fontSize:.02,fontColor:ATON.MatHub.colors.white}),i.infoContainer.add(i.infoNodeText)}),i.getInfoNode=(()=>i.infoNode),i.setInfoNodeText=(e=>{i.bShowInfo&&(i.infoNodeText.set({content:e}),ThreeMeshUI.update())}),i.createToolbar=((e,o)=>{let t=ATON.createUINode(),a=e.length,n=.3*i.STD_BTN_SIZE,r=new ThreeMeshUI.Block({width:i.STD_BTN_SIZE*a*1.1+n,height:i.STD_BTN_SIZE+n,padding:.01,borderRadius:.02,backgroundColor:o||ATON.MatHub.colors.black,backgroundOpacity:.3,fontFamily:i.PATH_FONT_JSON,fontTexture:i.PATH_FONT_TEX,alignContent:"center",justifyContent:"center"}),s=.5*a*i.STD_BTN_SIZE*1.1;s-=.5*i.STD_BTN_SIZE;for(let l=0;l<a;l++){let o=e[l];o&&(o.position.set(l*i.STD_BTN_SIZE*1.1-s,0,.005),r.add(o))}return t.add(r),t}),i.addMeasurementPoint=(e=>{if(void 0===e)return;let o=.01,t=.001;if(void 0===i._prevMPoint){i._prevMPoint=e;let o=i._measLine.geometry.attributes.position.array;return o[0]=e.x,o[1]=e.y,void(o[2]=e.z)}i._measLine.visible=!1;let a=i._prevMPoint.distanceTo(e);o*=a,t*=a;let n=new THREE.Mesh(ATON.Utils.geomUnitSphere,ATON.MatHub.getMaterial("measurement"));n.position.copy(i._prevMPoint),n.scale.set(o,o,o),i.gMeasures.add(n);let r=new THREE.Mesh(ATON.Utils.geomUnitSphere,ATON.MatHub.getMaterial("measurement"));r.position.copy(e),r.scale.set(o,o,o),i.gMeasures.add(r);let s=2*a,l=(new THREE.BufferGeometry).setFromPoints([i._prevMPoint,e]);i.gMeasures.add(new THREE.Line(l,ATON.MatHub.getMaterial("measurement")));let c=new i.Label;c.setBaseColor(ATON.MatHub.colors.white).setTextColor(ATON.MatHub.colors.black),c.setPosition(.5*(i._prevMPoint.x+e.x),.5*(i._prevMPoint.y+e.y),.5*(i._prevMPoint.z+e.z)),c.setScale(s).setText(ATON.Utils.getHumanReadableDistance(a)),i.gMeasures.add(c),i._measLabels.push(c);let T={};return T.A=i._prevMPoint.clone(),T.B=e.clone(),i._prevMPoint=void 0,T}),i.clearMeasurements=(()=>{i.gMeasures.removeChildren(),i._measLabels=[]}),i._updateMeasurements=(()=>{if(!(i._measLabels.length<=0))for(let e in i._measLabels)i._measLabels[e].orientToCamera()}),i.update=(()=>{if(ATON.Nav.isTransitioning()||ATON._bPauseQuery)i.infoNode.visible=!1;else{if(ThreeMeshUI.update(),i._prevMPoint){if(ATON._queryDataScene){let e=i._measLine.geometry.attributes.position.array;e[3]=ATON._queryDataScene.p.x,e[4]=ATON._queryDataScene.p.y,e[5]=ATON._queryDataScene.p.z,i._measLine.geometry.attributes.position.needsUpdate=!0}i._measLine.visible=!0}else i._measLine.visible=!1;if(ATON._queryDataScene&&!ATON.Nav._bInteracting?(i.mainSelector.visible=!0,i.mainSelector.position.copy(ATON._queryDataScene.p)):i.mainSelector.visible=!1,i.gSemIcons&&(ATON.Nav._bInteracting?i.gSemIcons.hide():void 0===ATON._hoveredSemNode&&i.gSemIcons.show()),ATON.Nav.isOrbit()&&!ATON.XR._bPresenting||!ATON.Nav.currentQueryValidForLocomotion()?i.fpTeleport.visible=!1:(i.fpTeleport.visible=!0,i.fpTeleport.position.copy(ATON._queryDataScene.p)),ATON.XR._pointerLineMesh){let e=0;ATON._queryDataScene&&(e=ATON._queryDataScene.d),ATON._queryDataUI&&(e<=0||ATON._queryDataUI.d<e)&&(e=ATON._queryDataUI.d,i.mainSelector.visible=!1,i.fpTeleport.visible=!1),e>0?(ATON.XR._pointerLineMesh.visible=!0,ATON.XR._pointerLineMesh.scale.set(1,1,e)):ATON.XR._pointerLineMesh.visible=!1}if(i._updateMeasurements(),ATON._queryDataSem){if(ATON.XR._bPresenting)ATON.XR.controller0?(i.infoNode.position.copy(ATON.XR.controller0pos),i.infoNode.position.x-=.1*ATON.XR.controller0dir.x,i.infoNode.position.y-=.1*ATON.XR.controller0dir.y,i.infoNode.position.z-=.1*ATON.XR.controller0dir.z,i.infoNode.setScale(i._labelScaleVR)):(i.infoNode.position.lerpVectors(ATON._queryDataSem.p,ATON.Nav._currPOV.pos,.5),i.infoNode.setScale(ATON._queryDataSem.d*i._labelScaleVR));else{i.infoNode.position.lerpVectors(ATON._queryDataSem.p,ATON.Nav._currPOV.pos,.2);const e=ATON._queryDataSem.d*(ATON.Nav._currPOV.fov/i._labelScale);i.infoNode.setScale(e)}i.infoNode.orientToCamera(),i.bShowInfo&&(i.infoNode.visible=!0),ATON.VRoadcast._bStreamFocus||(i.mainSelector.visible=!1)}else i.infoNode.visible=!1;if(i.mainSelector.visible&&ATON.VRoadcast._bStreamFocus){let e=i._selectorRad*(1+.2*Math.cos(10*ATON._clock.elapsedTime));i.mainSelector.scale.set(e,e,e)}}});var a=i;exports.default=a;
},{"./ATON.sui.button.js":"fWYX","./ATON.sui.label.js":"iqtl"}],"Qwfv":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=s(require("./ATON.node.js"));function s(e){return e&&e.__esModule?e:{default:e}}class t extends e.default{constructor(e){super(void 0,ATON.NTYPES.UI),this.userid=e,this.username=void 0,this.message="...",this._auTalk=new THREE.PositionalAudio(ATON.AudioHub._listener),this._auTalk.setRefDistance(30),this.add(this._auTalk),this._bPlayingAudio=!1,this._auChunks=[],this._tStateCall=-1,this._tProgress=0,this._tFocCall=-1,this._currFocusPos=new THREE.Vector3,this._tgtFocusPos=void 0,this._currState={},this._currState.position=new THREE.Vector3,this._currState.quaternion=new THREE.Quaternion,this._tgtState=void 0,this.realize()}setTalkDistance(e){e>0&&this._auTalk.setRefDistance(e)}getAvatarMaterialByUID(e){let s=ATON.MatHub.materials.avatars;return s[e%s.length]}realize(){let e=new THREE.SphereGeometry(.2,16,16);this.usermaterial=this.getAvatarMaterialByUID(this.userid);let s=new THREE.Mesh(e,this.usermaterial);this.usermeshnode=ATON.createUINode(),this.usermeshnode.add(s),this.usermeshnode.setMaterial(this.usermaterial),this.usermeshnode.setCloneOnLoadHit(!1),this.userauinode=new THREE.Sprite(ATON.VRoadcast.uspritemats[this.userid%ATON.VRoadcast.uspritemats.length]),this.userauinode.position.set(0,0,0),this.userauinode.visible=!1,this.userfpnode=new THREE.Sprite(ATON.VRoadcast.ufocmats[this.userid%ATON.VRoadcast.ufocmats.length]),this.userfpnode.position.set(0,0,0),this.userfpnode.visible=!1,this.userlabelnode=ATON.createUINode(),this.labelcontainer=new ThreeMeshUI.Block({width:.7,height:.25,padding:.03,borderRadius:.05,backgroundColor:ATON.MatHub.colors.black,fontFamily:ATON.PATH_RES+"fonts/custom-msdf.json",fontTexture:ATON.PATH_RES+"fonts/custom.png"}),this.userlabelnode.position.y=.4,this.userlabelnode.add(this.labelcontainer),this.usernametext=new ThreeMeshUI.Text({content:"User #"+this.userid,fontSize:.09,fontColor:ATON.VRoadcast.ucolors[this.userid%ATON.VRoadcast.ucolors.length]}),this.usernametext.position.y=0,this.usermessagetext=new ThreeMeshUI.Text({content:"\nHello World!",fontSize:.03,fontColor:ATON.MatHub.colors.white}),this.usermessagetext.position.y=-.03,this.labelcontainer.add(this.usernametext),this.labelcontainer.add(this.usermessagetext),this.add(this.usermeshnode),this.add(this.userlabelnode),this.add(this.userauinode),void 0===ATON.VRoadcast._focNodes[this.userid]&&(ATON.VRoadcast._focNodes[this.userid]=this.userfpnode,ATON.VRoadcast.focGroup.add(this.userfpnode))}destroy(){this.usermaterial&&this.usermaterial.dispose(),this.usermeshnode&&this.usermeshnode.dispose(),this.userauinode&&this.userauinode.dispose(),this.userfpnode&&this.userfpnode.dispose(),ATON.VRoadcast._focNodes[this.userid]&&ATON.VRoadcast._focNodes[this.userid].dispose(),this.userlabelnode&&this.userlabelnode.dispose(),this.labelcontainer&&this.labelcontainer.dispose(),this.usernametext&&this.usernametext.dispose(),this.usermessagetext&&this.usermessagetext.dispose(),this.dispose()}loadRepresentation(e){let s=this;return void 0!==s.usermeshnode.children[0]&&s.usermeshnode.remove(s.usermeshnode.children[0]),s.usermeshnode.load(e),this}setUsername(e){return this.username=e,this.usernametext.set({content:e}),this}getUsername(){if(void 0!==this.userid)return void 0===this.username?"User #"+this.userid:this.username}setMessage(e){return this.message=e,this.usermessagetext.set({content:"\n"+e}),this}setTalkVolume(e){if(void 0!==e)if(e>0){this.userauinode.visible=!0;let s=.1+.03*e;this.userauinode.scale.set(s,s,s)}else this.userauinode.visible=!1;else this.userauinode.visible=!1}hideFocalPoint(){this.userfpnode.visible=!1}requestFocus(e){this._tFocCall>=0||(this._tFocCall=ATON._clock.elapsedTime,this._currFocusPos.copy(this.userfpnode.position),this._tgtFocusPos=new THREE.Vector3(parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2])),this._tgtFocusRad=2*parseFloat(e[3]),this.userfpnode.scale.set(this._tgtFocusRad,this._tgtFocusRad,this._tgtFocusRad),this.userfpnode.visible=!0)}handleFocusTransition(){if(this._tFocCall<0)return;let e=ATON.VRoadcast.USER_STATE_FREQ,s=(ATON._clock.elapsedTime-this._tFocCall)/e;if(s>=1)return this._tFocCall=-1,this.userfpnode.position.copy(this._tgtFocusPos),this.userfpnode.scale.set(this._tgtFocusRad,this._tgtFocusRad,this._tgtFocusRad),void(this.userfpnode.visible=!0);this.userfpnode.position.lerpVectors(this._currFocusPos,this._tgtFocusPos,s),this.userfpnode.visible=!0}requestStateTransition(e){this._tStateCall>=0||(this._tStateCall=ATON._clock.elapsedTime,this._currState.position.copy(this.position),this._currState.quaternion.copy(this.quaternion),this._tgtState=e)}handleStateTransition(){if(this._tStateCall<0)return;let e=ATON.VRoadcast.USER_STATE_FREQ;this._tProgress=e<=0?1:(ATON._clock.elapsedTime-this._tStateCall)/e;let s=this._currState,t=this._tgtState;if(this._tProgress>=1)return this._tStateCall=-1,this.position.copy(t.position),void this.usermeshnode.quaternion.copy(t.quaternion);this.position.lerpVectors(s.position,t.position,this._tProgress),this.usermeshnode.quaternion.slerp(t.quaternion,this._tProgress)}update(){if(this.handleStateTransition(),this.userfpnode.visible){this.handleFocusTransition();let e=this.userfpnode.scale.x;e>.001?this.userfpnode.scale.set(.99*e,.99*e,.99*e):this.userfpnode.visible=!1}let e=ATON.Nav._camera,s=ATON.Nav._currPOV.pos;if(void 0===e||void 0===s)return;this.userlabelnode.orientToCamera();let t=this.userauinode.scale.x;(t*=.99)>.01?this.userauinode.scale.set(t,t,t):this.userauinode.visible=!1}_handleTalk(){if(this._bPlayingAudio)return;if(this._auChunks.length<1)return;let e=this._auChunks.shift(),s=new Audio;s.src=e.data,s.play(),this._bPlayingAudio=!0,s.onended=(()=>{this._bPlayingAudio=!1}),this.setTalkVolume(5)}}exports.default=t;
},{"./ATON.node.js":"XTSP"}],"mY3J":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=t(require("./ATON.avatar.js"));function t(e){return e&&e.__esModule?e:{default:e}}let o={USER_STATE_FREQ:.25,REPLICATED_EVT:"EREP",THRES_STATE_POS:.01,THRES_STATE_ORI:.08};o.Avatar=e.default,o.init=(()=>{o.address=window.location.origin,o.initMaterials(),o.socket=void 0,o._connected=!1,o._username=void 0,o.uid=void 0,o._bStreamFocus=!1,o._numUsers=1,o.avatarList=[],o.avaGroup=ATON.createUINode("avatars"),o.avaGroup.attachToRoot(),o.focGroup=ATON.createUINode("focus"),o.focGroup.attachTo(o.avaGroup),o._focNodes=[],o.bSendState=!0,window.setInterval(o.sendState,1e3*o.USER_STATE_FREQ),o._lastStateSent=void 0,o._bShowAvaG=!0,console.log("VRoadcast initialized"),o.enableChatLog()}),o.enableChatLog=(()=>{o._elChat=$("<div></div>").text("")}),o.getNumUsers=(()=>o._numUsers),o.initMaterials=(()=>{o.ucolors=[],o.ucolors.push(new THREE.Color(1,0,0)),o.ucolors.push(new THREE.Color(1,1,0)),o.ucolors.push(new THREE.Color(0,1,0)),o.ucolors.push(new THREE.Color(0,1,1)),o.ucolors.push(new THREE.Color(0,0,1)),o.ucolors.push(new THREE.Color(1,0,1)),o.ucolorsdark=[],o.ucolorsdark.push(new THREE.Color(.2,0,0)),o.ucolorsdark.push(new THREE.Color(.2,.2,0)),o.ucolorsdark.push(new THREE.Color(0,.2,0)),o.ucolorsdark.push(new THREE.Color(0,.2,.2)),o.ucolorsdark.push(new THREE.Color(0,0,.2)),o.ucolorsdark.push(new THREE.Color(.2,0,.2)),o.ucolorhex=[],o.ucolorhex.push("#F00"),o.ucolorhex.push("#FF0"),o.ucolorhex.push("#0F0"),o.ucolorhex.push("#0FF"),o.ucolorhex.push("#00F"),o.ucolorhex.push("#F0F");let e=ATON.MatHub.materials;e.avatars=[];let t=ATON.MatHub.materials.defUI.clone();t.uniforms.color.value=o.ucolors[0],e.avatars.push(t);for(let s=1;s<o.ucolors.length;s++){let r=t.clone();r.uniforms.color.value=o.ucolors[s],e.avatars.push(r)}o.uspritemats=[];let r=(new THREE.TextureLoader).load(ATON.PATH_RES+"useraui.png");for(let s=0;s<o.ucolors.length;s++){let e=new THREE.SpriteMaterial({map:r,depthWrite:!1,color:o.ucolors[s]});e.sizeAttenuation=!0,o.uspritemats.push(e)}o.ufocmats=[];let a=(new THREE.TextureLoader).load(ATON.PATH_RES+"focus.png");for(let s=0;s<o.ucolors.length;s++){let e=new THREE.SpriteMaterial({map:a,depthWrite:!1,depthTest:!1,color:o.ucolors[s]});e.sizeAttenuation=!0,o.ufocmats.push(e)}}),o.fireEvent=((e,t)=>{if(!o._connected)return;let r=o.socket;r&&r.emit(o.REPLICATED_EVT,{e:e,d:t})}),o.on=((e,t)=>{if(void 0===t)return;let o=ATON.EventHub.evNetwork;void 0===o[e]&&(o[e]=[]),o[e].push(t)}),o.isConnected=(()=>void 0!==o.socket&&o._connected),o.hasID=(()=>void 0!==o.uid),o.log=(e=>{if(!o._connected)return;let t=o.socket;t&&t.emit("LOG",e)}),o.joinSession=(e=>{o.socket&&(void 0===e&&(e=ATON.SceneHub.currID),void 0!==e?(console.log("Joining VRC session "+e+"..."),o.socket.emit("SENTER",e)):console.log("VRC ERROR: current session ID is undefined"))}),o.requestSceneState=(()=>{o.socket&&o.socket.emit("SSTATE")}),o.setAvatarsVisibility=(e=>{o._bShowAvaG=e,e?o.avaGroup.show():o.avaGroup.hide()}),o.connect=(e=>{if(o._connected)return;e&&(o.address=e);let t={};"https:"===window.location.protocol?(t.path="/svrc/socket.io",t.secure=!0,t.rejectUnauthorized=!1):t.path="/vrc/socket.io",o.socket=io.connect(o.address,t),void 0!==o.socket&&(o._connected=o.socket.connected,o._registerSocketHandlers())}),o.disconnect=(()=>{void 0!==o.socket&&(o._numUsers=1,o.socket.disconnect(),o._connected=!1)}),o._onConnected=(()=>{}),o.setUsername=(e=>{o._username=e,void 0!==o.socket&&void 0!==o.uid&&(o._elChat&&o._elChat.append("<i>Your username is now: "+e+"</i><br>"),o.socket.emit("UNAME",e))}),o.setMessage=(e=>{o._msg=e,void 0!==o.socket&&void 0!==o.uid&&(o._elChat&&(o._elChat.append("<span style='color:"+o.ucolorhex[o.uid%6]+"'><b>YOU</b>: "+e+"</span><br>"),o._elChat.scrollTop(o._elChat.scrollHeight)),o.socket.emit("UMSG",e))}),o._registerSocketHandlers=(()=>{o.socket.on("connect",()=>{o._connected=!0,void 0!==ATON.SceneHub.currID&&o.joinSession(),console.log("Connected to VRC service!"),ATON.fireEvent("VRC_Connected"),o._onConnected()}),o.socket.on("disconnect",()=>{o._connected=!1,o.uid=void 0,o.avaGroup.hide(),o._elChat&&o._elChat.append("<i>YOU disconnected from VRoadcast service</i><br>"),console.log("VRC disconnected!"),ATON.fireEvent("VRC_Disconnected")}),o.socket.on(o.REPLICATED_EVT,e=>{let t=e.e,o=e.d,r=ATON.EventHub.evNetwork[t];ATON.EventHub.executeHandlers(r,o)}),o.socket.on("ID",e=>{console.log("Your ID is "+e),o.uid=e,o._bShowAvaG&&o.avaGroup.show(),o._elChat&&o._elChat.append("<i>Your ID is #"+e+"</i><br>"),o.requestSceneState(),ATON.fireEvent("VRC_IDassigned",e)}),o.socket.on("SSTATE",e=>{o._numUsers=e.numUsers,console.log("Num. users: "+o._numUsers),ATON.fireEvent("VRC_SceneState",e)}),o.socket.on("UENTER",e=>{let t=e;console.log("User #"+t+" entered the scene"),o._elChat&&o._elChat.append("<i>User #"+t+" entered the scene</i><br>"),o.touchAvatar(t),o.requestSceneState(),ATON.fireEvent("VRC_UserEnter",t)}),o.socket.on("ULEAVE",e=>{let t=e;if(void 0===t)return;let r=o.avatarList[t];r&&r.hide(),console.log("User #"+t+" left the scene"),o._elChat&&o._elChat.append("<i>User #"+t+" left the scene</i><br>"),o.requestSceneState(),ATON.fireEvent("VRC_UserLeave",t)}),o.socket.on("USTATE",e=>{if(!o._bShowAvaG)return;let t=o.decodeState(e),r=t.userid;o.touchAvatar(r).requestStateTransition(t)}),o.socket.on("UFOCUS",e=>{let t=e.uid,r=e.fp;o.touchAvatar(t).requestFocus(r)}),o.socket.on("UNAME",e=>{let t=e.uid,r=e.name;void 0!==t&&(o.touchAvatar(t).setUsername(r),console.log("User #"+t+" changed username to: "+r),o._elChat&&o._elChat.append("<i>User #"+t+" changed username to: "+r+"</i><br>"))}),o.socket.on("UMSG",e=>{let t=e.uid,r=e.msg;if(void 0===t)return;let a=o.touchAvatar(t);a.setMessage(r),console.log("User #"+t+": "+r),o._elChat&&o._elChat.append("<span style='color:"+o.ucolorhex[t%6]+"'><b>"+a.getUsername()+"</b>: "+r+"</span><br>")}),o.socket.on("UTALK",e=>{let t=e.uid;if(void 0===t)return;let r=e.audio,a=o.touchAvatar(t);a.setTalkVolume(5),a._auTalk.isPlaying&&a._auTalk.stop(),ATON.AudioHub._loader.load(r,e=>{a._auTalk.setBuffer(e),a._auTalk.setLoop(!1),a._auTalk.play()}),r=null})}),o.encodeState=(e=>{if(!e)return;let t=new Float32Array(6);t[0]=e.position.x,t[1]=e.position.y,t[2]=e.position.z;var o=new Int8Array(t.buffer);return o[16]=128*e.quaternion.x,o[17]=128*e.quaternion.y,o[18]=128*e.quaternion.z,o[19]=128*e.quaternion.w,o[20]=e.userid,o}),o.decodeState=(e=>{let t={},o=new Int8Array(e);return t.userid=o[20],t.quaternion=new THREE.Quaternion(o[16]/128,o[17]/128,o[18]/128,o[19]/128),o=new Float32Array(e),t.position=new THREE.Vector3(o[0],o[1],o[2]),t}),o.update=(()=>{if(o._connected)for(let e=0;e<o.avatarList.length;e++){let t=o.avatarList[e];t&&t.visible&&t.update()}}),o.setFocusStreaming=(e=>{if(void 0!==e){if(e)return o._bStreamFocus||ATON.fireEvent("VRC_FocusStreamingStarted"),void(o._bStreamFocus=!0);{o._bStreamFocus&&ATON.fireEvent("VRC_FocusStreamingStopped");let e=ATON.SUI._selectorRad;ATON.SUI.mainSelector.scale.set(e,e,e),o._bStreamFocus=!1}}}),o.sendState=(()=>{if(!o.bSendState)return;if(void 0===o.uid)return;if(!o.socket||!o._connected)return;let e=ATON.Nav._currPOV;if(!e)return;let t=ATON.getSceneQueriedPoint();if(o._bStreamFocus&&void 0!==t){let e=t.x.toPrecision(5),r=t.y.toPrecision(5),a=t.z.toPrecision(5),s=ATON.SUI.getSelectorRadius().toPrecision(5);o.socket.emit("UFOCUS",[e,r,a,s])}let r={};if(r.position=new THREE.Vector3,r.quaternion=new THREE.Quaternion,r.position.copy(e.pos),r.quaternion.copy(ATON.Nav._qOri),r.userid=o.uid,void 0!==o._lastStateSent){let t=o._lastStateSent.position,r=o._lastStateSent.quaternion,a=t.distanceToSquared(e.pos),s=r.angleTo(ATON.Nav._qOri);if(a<o.THRES_STATE_POS&&s<o.THRES_STATE_ORI)return}let a=o.encodeState(r);o.socket.emit("USTATE",a),o._lastStateSent=r}),o.getAvatar=(e=>o.avatarList[e]),o.touchAvatar=(e=>{if(void 0===o.avatarList[e]){let t=new o.Avatar(e);t.attachTo(o.avaGroup),t.loadRepresentation(ATON.PATH_RES+"models/vrc/head.gltf"),o.avatarList[e]=t}let t=o.avatarList[e];return t.visible||(o._numUsers++,ATON.fireEvent("VRC_UserEnter",e)),o._bShowAvaG&&t.show(),t}),o.destroyAvatar=(e=>{let t=o.avatarList[e];void 0!==t&&t.destroy()}),o.clearAllAvatars=(()=>{for(let e in o.avatarList){o.avatarList[e].hide()}});var r=o;exports.default=r;
},{"./ATON.avatar.js":"Qwfv"}],"dQQK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;let e={FLOAT_PREC:5,init:()=>{e.bConvexBuilding=!1,e.convexPoints=[],e.convexNode=void 0,e.currConvexMesh=void 0,e.currSemNode=ATON.createSemanticNode(),e.currSemNode.disablePicking(),e.currSemNode.attachToRoot(),e.resetMaterial(),e._numShapes=0},resetMaterial:()=>{e.currMaterial=ATON.MatHub.getMaterial("semanticShapeHL")},setMaterial:t=>{void 0!==t&&(e.currMaterial=t)},addConvexPoint:t=>{if(void 0===t)return!1;if(e.convexPoints.length>0){let n=e.convexPoints[e.convexPoints.length-1];if(t.equals(n))return!1}e.convexPoints.push(t);let n=e.convexPoints.length,r=new THREE.Mesh(ATON.Utils.geomUnitSphere,ATON.MatHub.getMaterial("semanticShapeEdit"));if(r.position.copy(t),r.scale.set(.001,.001,.001),ATON.SUI.gPoints.add(r),n<4)return!1;let o=new THREE.ConvexGeometry(e.convexPoints),i=new THREE.Mesh(o,ATON.MatHub.getMaterial("semanticShapeEdit"));if(e.bConvexBuilding){let n=e.currConvexMesh;n.geometry.dispose(),n.geometry=o,ATON.Utils.setVectorPrecision(t,4),n.userData._convexPoints.push(t.x),n.userData._convexPoints.push(t.y),n.userData._convexPoints.push(t.z)}else{e.currSemNode.add(i),i.userData._convexPoints=[];for(let t=0;t<n;t++)ATON.Utils.setVectorPrecision(e.convexPoints[t],e.FLOAT_PREC),i.userData._convexPoints.push(e.convexPoints[t].x),i.userData._convexPoints.push(e.convexPoints[t].y),i.userData._convexPoints.push(e.convexPoints[t].z);e.currConvexMesh=i,e.bConvexBuilding=!0}return!0},undoConvexPoint:()=>{if(0!==e.convexPoints.length&&(e.convexPoints.pop(),e.currConvexMesh)){let t=e.currConvexMesh.userData;t._convexPoints&&t._convexPoints.pop()}},stopCurrentConvex:()=>{e.convexPoints=[],e.bConvexBuilding=!1,e.currSemNode.removeChildren(),ATON.SUI.gPoints.removeChildren()},getCurrentConvexShape:()=>e.currSemNode,isBuildingShape:()=>e.convexPoints.length>0,completeConvexShape:t=>{if(e.convexPoints=[],e.bConvexBuilding=!1,void 0===e.currSemNode)return;void 0===t&&(t="sem"+e._numShapes);let n=ATON.getSemanticNode(t)||ATON.createSemanticNode(t),r=e.currSemNode.children[0];return ATON.SUI.addSemIcon(t,r),n.add(r),n.setMaterial(ATON.MatHub.materials.semanticShape),n.setDefaultAndHighlightMaterials(ATON.MatHub.materials.semanticShape,e.currMaterial),n.enablePicking(),e.currSemNode.removeChildren(),e._numShapes++,ATON.SUI.gPoints.removeChildren(),ATON._bqSem=!0,n},createConvexShape:(t,n)=>{let r=new THREE.ConvexGeometry(n),o=new THREE.Mesh(r,ATON.MatHub.materials.semanticShape);o.userData._convexPoints=[];for(let e=0;e<n.length;e++){let t=n[e];ATON.Utils.setVectorPrecision(t,4),o.userData._convexPoints.push(t.x),o.userData._convexPoints.push(t.y),o.userData._convexPoints.push(t.z)}ATON.SUI.addSemIcon(t,o);let i=ATON.getOrCreateSemanticNode(t);return i.add(o),i.setDefaultAndHighlightMaterials(ATON.MatHub.materials.semanticShape,e.currMaterial),i.enablePicking(),ATON._bqSem=!0,i},addSurfaceConvexPoint:t=>{if(void 0===ATON._queryDataScene)return!1;void 0===t&&(t=.02);let n=ATON._queryDataScene.p,r=ATON.Nav.getCurrentEyeLocation();return n.lerpVectors(n,r,t),e.addConvexPoint(n),n},createSphere:(t,n,r)=>{if(void 0===n)return;if(void 0===r)return;void 0===t&&(t="sem"+e._numShapes);let o=ATON.getOrCreateSemanticNode(t),i=new THREE.Mesh(ATON.Utils.geomUnitSphere,ATON.MatHub.materials.semanticShape),a=new THREE.Object3D;return a.position.copy(n),a.scale.set(r,r,r),a.add(i),ATON.SUI.addSemIcon(t,a),o.add(a),o.enablePicking(),o.setDefaultAndHighlightMaterials(ATON.MatHub.materials.semanticShape,e.currMaterial),e._numShapes++,ATON._bqSem=!0,o},createSurfaceSphere:t=>{if(!ATON._queryDataScene)return;let n=ATON._queryDataScene.p,r=ATON.SUI.getSelectorRadius();return e.createSphere(t,n,r)},deleteSemanticNode:e=>{let t=ATON.getSemanticNode(e);if(void 0===t)return!1;if(t.removeChildren(),void 0===ATON.SUI.gSemIcons)return!0;for(let n in ATON.SUI.gSemIcons.children){let t=ATON.SUI.gSemIcons.children[n];t&&t.name===e&&ATON.SUI.gSemIcons.removeChild(t)}return!0}};var t=e;exports.default=t;
},{}],"Z6YW":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;let e={SEMSHAPE_SPHERE:0,SEMSHAPE_CONVEX:1,POPUP_DELAY:300,realize:()=>{e.PATH_RES_ICONS=ATON.PATH_RES+"icons/",e._bPopup=!1,e.popupBlurBG=.5,e._userAuth={},e._bControlLight=!1,e._bControlSelScale=!1,e._cLightDir=new THREE.Vector3,e._auSemNode=void 0,e._auSemNodePlaying=!1,e._bReqHome=!1,e._vrcAddr=void 0,e._bVRCsetup=!1,e.urlParams=new URLSearchParams(window.location.search),e._uiSetupBase(),e._uiProfiles={},e._uiCurrProfile=void 0,e._selRanges=[.01,50],e._selRefRadius=.5,ATON.realize(),ATON.on("Fullscreen",t=>{e.uiSwitchButton("fullscreen",t)});let t=ATON.FE.urlParams.get("d");t&&t>0&&ATON.setDefaultPixelDensity(t)},_handleHomeReq:()=>{e._bReqHome||(e._bReqHome=!0,void 0!==ATON.Nav.homePOV?ATON.Nav.requestHome(1):ATON.Nav.computeAndRequestDefaultHome(.5))},addBasicLoaderEvents:()=>{ATON.on("NodeRequestFired",()=>{$("#idLoader").show()}),ATON.on("SceneJSONLoaded",()=>{ATON.SceneHub.getDescription()&&$("#btn-info").show(),void 0!==ATON.Nav.homePOV&&ATON.Nav.requestHome(1)}),ATON.on("AllNodeRequestsCompleted",()=>{$("#idLoader").hide(),ATON._ccModels.length>0&&$("#btn-cc").show(),e.computeSelectorRanges(),ATON.Nav.isOrbit()&&ATON.SUI.setSelectorRadius(e._selRefRadius),e._handleHomeReq()}),ATON.addUpdateRoutine(e._update)},controlLight:t=>{e._bControlLight=t,ATON.Nav.setUserControl(!t)},controlSelectorScale:t=>{e._bControlSelScale=t,ATON._bPauseQuery=t,ATON.Nav.setUserControl(!t)},useMouseWheelToScaleSelector:t=>{void 0===t&&(t=.9),ATON.on("MouseWheel",o=>{if(ATON._kModCtrl){let e=ATON.Nav.getFOV();return o>0?e+=1:e-=1,void ATON.Nav.setFOV(e)}if(ATON._kModShift){let i=ATON.SUI.mainSelector.scale.x;return o>0?i*=t:i/=t,i<e._selRanges[0]&&(i=e._selRanges[0]),i>e._selRanges[1]&&(i=e._selRanges[1]),void ATON.SUI.setSelectorRadius(i)}})},loadSceneID:e=>{if(void 0===e)return;let t=ATON.PATH_RESTAPI_SCENE+e;ATON.SceneHub.load(t,e),$("meta[property=og\\:image]").attr("content",ATON.PATH_SCENES+e+"/cover.png"),$("meta[property=og\\:image\\:secure_url]").attr("content",ATON.PATH_SCENES+e+"/cover.png"),$("meta[property=og\\:image\\:type]").attr("content","image/png"),$("meta[property=og\\:image\\:width]").attr("content","200"),$("meta[property=og\\:image\\:height]").attr("content","200"),console.log(t)},_update:()=>{if(e._bControlLight){const t=ATON._screenPointerCoords.x,o=ATON._screenPointerCoords.y;e._cLightDir.x=-Math.cos(t*Math.PI),e._cLightDir.y=2*-o,e._cLightDir.z=-Math.sin(t*Math.PI),e._cLightDir.normalize(),ATON.setMainLightDirection(e._cLightDir)}},uiBasicSetup:()=>{e.uiAddButton("idTopToolbar","fullscreen",ATON.toggleFullScreen),ATON.Utils.isConnectionSecure()&&e.uiAddButton("idTopToolbar","vr",ATON.XR.toggle),e.uiAddButton("idBottomToolbar","home",()=>{ATON.Nav.requestHome(.1)})},_uiSetupBase:()=>{$("#idPopup").click(e.popupClose),$("#idLoader").html("<img src='"+ATON.PATH_RES+"loader.png'>")},uiAddButton:(t,o,i,s)=>{let d,a;o.endsWith(".png")?(d=o,a=o.slice(0,-4)):(d=e.PATH_RES_ICONS+o+".png",a=o);let n=$("<div id='"+("btn-"+a)+"' class='atonBTN' ><img src='"+d+"'></div>");$("#"+t).append(n),i&&n.click(i),s&&n.attr("title",s)},uiSwitchButton:(e,t)=>{t?$("#btn-"+e).addClass("switchedON"):$("#btn-"+e).removeClass("switchedON")},uiAddButtonHome:t=>{e.uiAddButton(t,"home",()=>{ATON.Nav.requestHome(.3)},"Home viewpoint")},uiAddButtonFirstPerson:t=>{e.uiAddButton(t,"fp",()=>{ATON.Nav.isFirstPerson()?(ATON.Nav.setOrbitControl(),e.uiSwitchButton("fp",!1)):(ATON.Nav.setFirstPersonControl(),e.uiSwitchButton("fp",!0))},"First-person navigation mode"),ATON.Nav.isFirstPerson()?e.uiSwitchButton("fp",!0):e.uiSwitchButton("fp",!1)},uiAddButtonVR:t=>{ATON.Utils.isConnectionSecure()&&e.uiAddButton(t,"vr",ATON.XR.toggle,"Immersive VR mode")},uiAddButtonDeviceOrientation:t=>{ATON.Utils.isConnectionSecure()&&ATON.Utils.isMobile()&&(e.uiAddButton(t,"devori",()=>{ATON.Nav.isDevOri()?(ATON.Nav.restorePreviousNavMode(),e.uiSwitchButton("devori",!1)):(ATON.Nav.setDeviceOrientationControl(),e.uiSwitchButton("devori",!0))},"Device-orientation mode"),ATON.Nav.isDevOri()?e.uiSwitchButton("devori",!0):e.uiSwitchButton("devori",!1))},uiAddButtonNav:t=>{e.uiAddButton(t,"nav",()=>{e.popupNav()},"Navigation")},uiAddButtonTalk:t=>{ATON.Utils.isConnectionSecure()&&(e.uiAddButton(t,"talk",()=>{ATON.MediaRec.isAudioRecording()?(ATON.MediaRec.stopMediaStreaming(),$("#btn-talk").removeClass("atonBTN-rec")):(ATON.MediaRec.startMediaStreaming(),$("#btn-talk").addClass("atonBTN-rec"))},"Talk ON/OFF"),ATON.MediaRec.isAudioRecording()?$("#btn-talk").addClass("atonBTN-rec"):$("#btn-talk").removeClass("atonBTN-rec"))},uiAddButtonStreamFocus:t=>{e.uiAddButton(t,"focus",()=>{ATON.VRoadcast._bStreamFocus?(ATON.VRoadcast.setFocusStreaming(!1),$("#btn-focus").removeClass("atonBTN-rec")):(ATON.VRoadcast.setFocusStreaming(!0),$("#btn-focus").addClass("atonBTN-rec"))},"Focus streaming ON/OFF"),ATON.VRoadcast._bStreamFocus?$("#btn-focus").addClass("atonBTN-rec"):$("#btn-focus").removeClass("atonBTN-rec")},uiAddButtonQR:t=>{e.uiAddButton(t,"qr",e.popupQR,"QR-code")},uiAddButtonInfo:t=>{e.uiAddButton(t,"info",ATON.FE.popupSceneInfo,"Scene information"),$("#btn-info").hide()},uiAddButtonFullScreen:t=>{e.uiAddButton(t,"fullscreen",()=>{ATON.toggleFullScreen()},"Fullscreen"),e.uiSwitchButton("fullscreen",ATON.isFullscreen())},uiAddKeywordsArea:(t,o,i,s)=>{let d="";d+="Add keyword: <input id='idKWordInput' type='text' maxlength='100' size='20'><div class='atonBTN atonBTN-green' id='idKWadd'><img src='"+ATON.FE.PATH_RES_ICONS+"add.png'></div><br>",d+="<div id='idKWords'></div>",$("#"+t).html(d),e.uiAttachInputFilterID("idKWordInput");let a={},n=e=>{a[e]||(e=e.toLowerCase().trim(),$("#idKWordInput").val(""),a[e]=1,console.log("Added keyword "+e),i&&i(e),$("#idKWords").append("<div class='atonKeyword atonKeywordActivable' id='idkw-"+e+"'>"+e+"</div>"),$("#idkw-"+e).click(()=>{$("#idkw-"+e).remove(),a[e]=void 0,console.log("Removed keyword "+e),s&&s(e)}))};if(o)for(let e in o)n(o[e]);$("#idKWordInput").keypress(function(e){if("13"!=(e.keyCode?e.keyCode:e.which))return;let t=$("#idKWordInput").val().toLowerCase().trim();!t||t.length<3||n(t)}),$("#idKWadd").click(()=>{let e=$("#idKWordInput").val().toLowerCase().trim();!e||e.length<3||n(e)})},getVRCclassFromID:e=>{return"atonVRCu"+e%6},_setupVRCevents:()=>{e._bVRCsetup||(ATON.on("VRC_IDassigned",t=>{$("#btn-vrc").addClass(e.getVRCclassFromID(t)),ATON.SUI.setSelectorColor(ATON.VRoadcast.ucolors[t%6]),e.checkAuth(e=>{void 0!==e.username&&ATON.VRoadcast.setUsername(e.username)})}),ATON.on("VRC_SceneState",e=>{let t=ATON.VRoadcast.getNumUsers();t>1?$("#idVRCnumusers").html(t):$("#idVRCnumusers").html(""),console.log("Users: "+t)}),ATON.on("VRC_Disconnected",()=>{$("#btn-vrc").attr("class","atonBTN"),ATON.SUI.setSelectorColor(ATON.MatHub.colors.defUI),$("#idVRCnumusers").html("")}),e._bVRCsetup=!0)},uiAddButtonVRC:t=>{e.uiAddButton(t,"vrc",()=>{ATON.VRoadcast.isConnected()?e.popupVRC():ATON.VRoadcast.connect(e._vrcAddr)},"VRoadcast (collaborative session)"),$("#btn-vrc").append("<span id='idVRCnumusers' class='atonVRCcounter'></span>"),e._setupVRCevents(),void 0!==ATON.VRoadcast.uid?$("#btn-vrc").addClass(e.getVRCclassFromID(ATON.VRoadcast.uid)):$("#btn-vrc").attr("class","atonBTN")},uiAddButtonUser:t=>{e.uiAddButton(t,"user",()=>{e.popupUser()},"User"),e.checkAuth(e=>{void 0!==e.username?$("#btn-user").addClass("switchedON"):$("#btn-user").removeClass("switchedON")})},uiAddButtonEditMode:t=>{e.uiAddButton(t,"edit",()=>{e.checkAuth(t=>{void 0!==t.username?(ATON.SceneHub._bEdit=!ATON.SceneHub._bEdit,e.uiSwitchButton("edit",ATON.SceneHub._bEdit)):e.popupUser()})})},uiAddProfile:(t,o)=>{"function"==typeof o&&(e._uiProfiles[t]=o)},uiLoadProfile:t=>{let o=e._uiProfiles[t];void 0!==o&&(o(),e._uiCurrProfile=t,console.log("Loaded UI Profile: "+e._uiCurrProfile))},attachHandlerToButton:(e,t)=>{void 0!==t&&$("#"+e).click(()=>{t()})},uiAttachInputFilterID:e=>{$("#"+e).on("keyup change input",()=>{let t=$("#"+e).val(),o=new RegExp("[^A-Za-z0-9-_]","ig");$("#"+e).val(t.replace(o,""))})},switchNode:(e,t,o)=>{let i=void 0;void 0!==(i=o===ATON.NTYPES.SEM?ATON.getSemanticNode(e):ATON.getSceneNode(e))&&(i.toggle(t),ATON.fireEvent("FE_NodeSwitch",{nid:e,t:o,v:t}))},uiCreateGraph:e=>{let t=ATON.snodes;e===ATON.NTYPES.SEM&&(t=ATON.semnodes);let o="";for(let i in t){let s=t[i].visible?"checked":"";"."!==i&&(o+="<input type='checkbox' "+s+" onchange=\"ATON.FE.switchNode('"+i+"',this.checked,"+e+');">'+i+"<br>")}return o},setupBasicUISounds:()=>{e.auLib={},e.auLib.switch=new Audio(ATON.PATH_RES+"audio/switch.wav"),e.auLib.switch.loop=!1},playAudioFromSemanticNode:t=>{if(void 0===t)return;let o=ATON.getSemanticNode(t);if(void 0===o)return;let i=o.getAudio();void 0!==i&&(void 0===e._auSemNode||null===e._auSemNode?e._auSemNode=new THREE.Audio(ATON.AudioHub._listener):e._auSemNode.stop(),ATON.AudioHub._loader.load(i,t=>{e._auSemNode.setBuffer(t),e._auSemNode.setLoop(!1),e._auSemNode.play()}))},popupShow:(t,o)=>{if(e._bPopup)return!1;let i="atonPopup ";o&&(i+=o);let s="<div id='idPopupContent' class='"+i+"'>";return s+=t+"</div>",$("#idPopup").html(s),$("#idPopupContent").click(e=>{e.stopPropagation()}),$("#idPopup").fadeIn(e.POPUP_DELAY),e._bPopup=!0,ATON._bListenKeyboardEvents=!1,e.popupBlurBG>0&&(ATON._renderer.setPixelRatio(e.popupBlurBG),ATON._renderer.render(ATON._mainRoot,ATON.Nav._camera)),ATON._bPauseQuery=!0,$("#idTopToolbar").hide(),$("#idBottomToolbar").hide(),$("#idBottomRToolbar").hide(),$("#idPoweredBy").hide(),!0},popupClose:t=>{e._bPopup=!1,ATON._bListenKeyboardEvents=!0,e.popupBlurBG>0&&ATON.resetPixelDensity(),!0===t?$("#idPopup").hide():$("#idPopup").fadeOut(e.POPUP_DELAY),ATON._bPauseQuery=!1,$("#idTopToolbar").show(),$("#idBottomToolbar").show(),$("#idBottomRToolbar").show(),$("#idPoweredBy").show(),ATON.focusOn3DView()},subPopup:e=>{ATON.FE.popupClose(),setTimeout(e,ATON.FE.POPUP_DELAY)},popupQR:()=>{let e="<div class='atonPopupTitle'>Share</div>";if(e+="<div class='atonQRcontainer' id='idQRcode'></div><br><br>",!ATON.FE.popupShow("<div class='atonPopupTitle'>Share</div><div class='atonQRcontainer' id='idQRcode'></div><br><br>"))return;let t=window.location.href;new QRCode(document.getElementById("idQRcode"),t)},popupScreenShot:()=>{let t=ATON.Utils.takeScreenshot(200);e.checkAuth(o=>{let i="<div class='atonPopupTitle'>Screenshot</div>";i+="This is a preview of what your screenshot will look like:<br><br>",i+="<img src='"+t.src+"'><br>",i+="Resolution: <input id='isShotSize' type='number' min='100' max='4000' value='200'>px<br>",i+="<div class='atonBTN atonBTN-green' id='btnScreenShot' style='width:90%'><img src='"+e.PATH_RES_ICONS+"sshot.png'>SHOT</div>",void 0!==o.username&&(i+="<div class='atonBTN atonBTN-green' id='btnSetCover' style='width:90%'>Set as Cover</div>"),ATON.FE.popupShow(i)&&($("#btnScreenShot").click(()=>{ATON.FE.popupClose();let e=parseInt($("#isShotSize").val());ATON.Utils.takeScreenshot(e,"shot.png")}),$("#btnSetCover").click(()=>{ATON.FE.popupClose(),ATON.Utils.postJSON(ATON.PATH_RESTAPI+"cover/scene/",{sid:ATON.SceneHub.currID,img:t.src},e=>{console.log(e)})}))})},popupVRC:()=>{let e="",t=ATON.VRoadcast.getNumUsers();e+=t>1?"<div class='atonPopupTitle'>Collaborative Session ("+t+" users)</div>":"<div class='atonPopupTitle'>Collaborative Session</div>",e+="<input id='idVRCusername' type='text' size='10' placeholder='username...' style='display:none'>",e+="<div id='idVRCusernameBTN' class='atonBTN' style='width:150px; display:none'>"+ATON.VRoadcast._username+"</div>",e+="<div id='idChatBox' style='width:100%; height:150px; text-align:left;' class='scrollableY'></div>",e+="<input id='idVRCmsg' style='width:90%' type='text' placeholder='message...'>",e+="<div class='atonBTN' id='idVRCdisconnect' style='width:90%'>LEAVE</div>",ATON.FE.popupShow(e,"atonPopupLarge")&&(void 0===ATON.VRoadcast._username?($("#idVRCusername").show(),$("#idVRCusernameBTN").hide()):($("#idVRCusername").val(ATON.VRoadcast._username),$("#idVRCusername").hide(),$("#idVRCusernameBTN").show()),void 0!==ATON.VRoadcast.uid&&$("#idVRCusernameBTN").addClass("atonVRCu"+ATON.VRoadcast.uid%6),$("#idChatBox").append(ATON.VRoadcast._elChat),$("#idVRCmsg").keypress(e=>{if("13"==(e.keyCode?e.keyCode:e.which)){let e=$("#idVRCmsg").val();ATON.VRoadcast.setMessage(e),$("#idVRCmsg").val("")}}),$("#idVRCusername").keypress(e=>{if("13"==(e.keyCode?e.keyCode:e.which)){let e=$("#idVRCusername").val();ATON.VRoadcast.setUsername(e),$("#idVRCusername").hide(),$("#idVRCusernameBTN").html(ATON.VRoadcast._username),$("#idVRCusernameBTN").show()}}),$("#idVRCusernameBTN").click(()=>{$("#idVRCusername").show(),$("#idVRCusernameBTN").hide()}),$("#idVRCdisconnect").click(()=>{ATON.VRoadcast.disconnect(),ATON.FE.popupClose()}))},checkAuth:t=>{ATON.Utils.checkAuth(o=>{e._userAuth=o,void 0!==o.username?($("#btn-user").addClass("switchedON"),void 0===ATON.VRoadcast._username&&ATON.VRoadcast.setUsername(o.username)):$("#btn-user").removeClass("switchedON"),t&&t(o)})},popupUser:()=>{e.checkAuth(t=>{if(void 0!==t.username){let o="<img src='"+e.PATH_RES_ICONS+"user.png'><br>";if(o+="<b>'"+t.username+"'</b><br><br>",Object.keys(e._uiProfiles)){o+="UI Profile:<br><div class='select' style='width:150px;'><select id='idUIProfiles'>";for(let t in e._uiProfiles)o+="<option value='"+t+"'>"+t+"</option>";o+="</select><div class='selectArrow'></div></div><br><br>"}if(o+="<div class='atonBTN atonBTN-red' id='idLogoutBTN' style='width:90%'>LOGOUT</div>",!ATON.FE.popupShow(o))return;e._uiCurrProfile&&(console.log(e._uiCurrProfile),$("#idUIProfiles").val(e._uiCurrProfile)),$("#idLogoutBTN").click(()=>{$.get(ATON.PATH_RESTAPI+"logout",e=>{console.log(e),ATON.SceneHub.setEditMode(!1),ATON.fireEvent("Logout"),$("#btn-user").removeClass("switchedON")}),ATON.FE.popupClose()}),$("#idSHUscenes").click(()=>{ATON.Utils.goToURL("/shu/scenes/")}),$("#idSHUuser").click(()=>{ATON.Utils.goToURL("/shu/auth/")}),$("#idUIProfiles").on("change",()=>{let t=$("#idUIProfiles").val();e.uiLoadProfile(t),ATON.FE.popupClose()})}else{let t="<img src='"+e.PATH_RES_ICONS+"user.png'><br>";if(t+="username:<input id='idUsername' type='text' maxlength='15' size='15' ><br>",t+="password:<input id='idPassword' type='password' maxlength='15' size='15' ><br>",t+="<div class='atonBTN atonBTN-green' id='idLoginBTN' style='width:90%'>LOGIN</div>",!ATON.FE.popupShow(t))return;$("#idLoginBTN").click(()=>{let e=JSON.stringify({username:$("#idUsername").val(),password:$("#idPassword").val()});$.ajax({url:ATON.PATH_RESTAPI+"login",type:"POST",data:e,contentType:"application/json; charset=utf-8",dataType:"json",success:e=>{console.log(e),e&&(ATON.fireEvent("Login",e),$("#btn-user").addClass("switchedON"),ATON.FE.popupClose())}}).fail(e=>{$("#idLoginBTN").html("LOGIN FAILED"),$("#idLoginBTN").attr("class","atonBTN atonBTN-red")})})}})},popupSceneInfo:()=>{let e=ATON.SceneHub.getTitle();void 0===e&&(e=ATON.SceneHub.currID);let t=ATON.SceneHub.getDescription(),o="<div class='atonPopupTitle'>"+e+"</div>";t&&(o+="<div class='atonPopupDescriptionContainer'>"+JSON.parse(t)+"</div>"),o+="<div class='atonBTN atonBTN-green' id='btnOK' style='width:90%'>OK</div>",ATON.FE.popupShow(o)&&$("#btnOK").click(()=>{ATON.FE.popupClose()})},computeSelectorRanges:()=>{let t=ATON.getRootScene().getBound().radius;t<=0||(e._selRanges[0]=.001*t,e._selRefRadius=.02*t,e._selRanges[1]=.5*t)},popupSelector:()=>{let t="<div class='atonPopupTitle'>3D Selector</div>",o=ATON.SUI.getSelectorRadius(),i=ATON.Utils.getHumanReadableDistance(o);e.computeSelectorRanges(),t+="Radius (<span id='idSelRadTxt'>"+i+"</span>):<br>",t+="<input id='idSelRad' type='range' min='"+e._selRanges[0]+"' max='"+e._selRanges[1]+"' step='"+e._selRanges[0]+"' style='width:90%'>",ATON.FE.popupShow(t,"atonPopupLarge")&&($("#idSelRad").val(o),$("#idSelRad").on("input change",()=>{let e=parseFloat($("#idSelRad").val());ATON.SUI.setSelectorRadius(e),$("#idSelRadTxt").html(ATON.Utils.getHumanReadableDistance(e))}))},popupNav:()=>{let t="<div class='atonPopupTitle'>Navigation</div>";t+="<div style='display:block; width:90%; min-height:50px; vertical-align:top'>",t+="<div style='display:inline-block; width:60px; float:left' id='idNMfp'></div>",t+="<div style='text-align:left'>Switch between first-person and orbit navigation mode</div>",t+="</div>",ATON.Utils.isConnectionSecure()&&(t+="<div style='display:block; width:90%; min-height:50px; vertical-align:top'>",t+="<div style='display:inline-block; width:60px; float:left' id='idNMvr'></div>",t+="<div style='text-align:left'>Immersive VR mode</div>",t+="</div>",ATON.Utils.isMobile()&&(t+="<div style='display:block; width:90%; min-height:50px; vertical-align:top'>",t+="<div style='display:inline-block; width:60px; float:left' id='idNMdevori'></div>",t+="<div style='text-align:left'>Enable or disable device-orientation mode</div>",t+="</div>")),e.popupShow(t)&&(e.uiAddButtonFirstPerson("idNMfp"),e.uiAddButtonDeviceOrientation("idNMdevori"),e.uiAddButtonVR("idNMvr"))}};var t=e;exports.default=t;
},{}],"jdcn":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;let e={auType:"audio/wav",auExt:".wav",auBitsPerSecond:9e3,auStreamInterval:1e3,auMinVol:1,init:()=>{e._bAudioRecording=!1,e._bStreaming=!1,e.recorder=void 0},realizeAudioRecorder:r=>{if(void 0!==e.recorder)e.recorder.reset(),r&&r();else{if(!ATON.Utils.isConnectionSecure())return;if(!navigator.mediaDevices)return;void 0===e._ds&&(e._ds=setInterval(e._streamChunk,e.auStreamInterval)),navigator.mediaDevices.getUserMedia({video:!1,audio:!0,channelCount:1,echoCancellation:!0}).then(async function(o){e.recorder=RecordRTC(o,{type:"audio",mimeType:e.auType,bitsPerSecond:e.auBitsPerSecond,audioBitsPerSecond:e.auBitsPerSecond,sampleRate:22050,desiredSampRate:22050,disableLogs:!0,numberOfAudioChannels:1}),r&&r()})}},isAudioRecording:()=>e._bAudioRecording,_stopRecAndSend:r=>{void 0!==e.recorder?e.recorder.stopRecording(()=>{e.recorder.getDataURL(e=>{ATON.VRoadcast.socket&&void 0!==ATON.VRoadcast.uid?(ATON.VRoadcast.socket.compress(!1).emit("UTALK",{audio:e,uid:ATON.VRoadcast.uid}),r&&r()):r&&r()})}):r&&r()},_onAuBlob:r=>{r&&ATON.VRoadcast.socket&&ATON.VRoadcast.socket.emit("UTALK",{blob:r,uid:ATON.VRoadcast.uid,vol:e._auAVGvolume})},startRecording:()=>{e.realizeAudioRecorder(()=>{e.recorder&&(e._bAudioRecording||(console.log("Recording..."),e.recorder.startRecording(),e._bAudioRecording=!0))})},stopRecording:()=>{e.recorder&&e.recorder.stopRecording(()=>{let r=e.recorder.getBlob();console.log("Stop recording.");let o=new FileReader;o.readAsDataURL(r),o.onloadend=(()=>{let e=o.result;ATON.fireEvent("AudioRecordCompleted",e)}),e._bAudioRecording=!1})},startOrStopRecording:()=>{e._bAudioRecording?e.stopRecording():e.startRecording()},_streamChunk:()=>{e.recorder&&e._bStreaming&&e._stopRecAndSend(()=>{e.recorder.startRecording()})},startMediaStreaming:()=>{e.realizeAudioRecorder(()=>{e.recorder&&(e._bAudioRecording||(console.log("Start MediaStreaming"),e.recorder.startRecording(),e._bAudioRecording=!0,e._bStreaming=!0))})},stopMediaStreaming:()=>{e.recorder&&e._bAudioRecording&&(console.log("Stop MediaStreaming"),e._stopRecAndSend(()=>{}),e._bStreaming=!1,e._bAudioRecording=!1)},startOrStopMediaStreaming:()=>{e._bAudioRecording?e.stopMediaStreaming():e.startMediaStreaming()}};var r=e;exports.default=r;
},{}],"uZX1":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;let t={EARTH_R_KM:6371};t.EARTH_D_KM=2*t.EARTH_R_KM,t.init=(()=>{t._bActive=!1,t._wpid=void 0,t._currPos=new THREE.Vector2,t._POIs=[],t._currPOI=void 0,t._closestPOI=void 0,t._maxError=40}),t.enableTracking=(()=>{t._bActive||ATON.Utils.isConnectionSecure()&&navigator.geolocation&&(t._wpid=navigator.geolocation.watchPosition(t._onPosition,t._onError,{enableHighAccuracy:!0}),t._bActive=!0)}),t.disableTracking=(()=>{t._bActive&&(navigator.geolocation.clearWatch(t._wpid),t._bActive=!1)}),t.setMaxError=(e=>{e>0&&(t._maxError=e)}),t._onError=(()=>{console.log("Geolocation error")}),t._onPosition=(e=>{if(!t._bActive)return;if(!e.coords)return;let o=e.coords.accuracy;o&&o>t._maxError||(t._currPos.x=e.coords.latitude,t._currPos.y=e.coords.longitude,ATON.fireEvent("GeoLocation",e),t._handlePOIs())}),t._handlePOIs=(()=>{let e=t._POIs.length;if(!(e<=0)){t._closestPOIdist=void 0,t._closestPOI=void 0;for(let o=0;o<e;o++){let e=t._POIs[o],r=t.distance(t._currPos,e.pos);(void 0===t._closestPOIdist||r<t._closestPOIdist)&&(t._closestPOIdist=r,t._closestPOI=o),r<=e.radius?(t._currPOI!==o&&ATON.fireEvent("EnterPOI",{id:o,distance:r}),t._currPOI=o):(void 0!==t._currPOI&&ATON.fireEvent("LeavePOI",{id:t._currPOI,distance:r}),t._currPOI=void 0)}}}),t.getCurrentLocation=(()=>{if(t._bActive)return t._currPos}),t.locationFromLatLon=((t,e)=>new THREE.Vector2(t,e)),t.distance_orig=((e,o)=>{let r=ATON.DEG2RAD*(o.x-e.x),s=ATON.DEG2RAD*(o.y-e.y),i=Math.sin(r/2)*Math.sin(r/2)+Math.cos(ATON.DEG2RAD*e.x)*Math.cos(ATON.DEG2RAD*o.x)*Math.sin(s/2)*Math.sin(s/2),c=2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i));return 1e3*(t.EARTH_R_KM*c)}),t.distance=((e,o)=>{let r=.5-Math.cos((o.x-e.x)*ATON.DEG2RAD)/2+Math.cos(e.x*ATON.DEG2RAD)*Math.cos(o.x*ATON.DEG2RAD)*(1-Math.cos((o.y-e.y)*ATON.DEG2RAD))/2;return 1e3*(t.EARTH_D_KM*Math.asin(Math.sqrt(r)))}),t.addPOI=((e,o)=>{let r={};return r.pos=new THREE.Vector2(e.x,e.y),r.radius=o,t._POIs.push(r),t._bActive||t.enableTracking(),t._handlePOIs(),t._POIs.length-1}),t.getPOIbyIndex=(e=>t._POIs[e]),t.getClosestPOI=(()=>t._closestPOI),t.getClosestPOIdistance=(()=>t._closestPOIdist);var e=t;exports.default=e;
},{}],"Iy9y":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;let t={init:()=>{t._appid=$("meta[name='aton\\:appid']").attr("content"),t._appdata={}},_sendDataPatch:(a,e,o)=>new Promise((d,i)=>{if(void 0===a)return void i("No storage ID specified");if(a.length<3)return void i("Storage ID too short");if(void 0===e)return void i("No storage patch");if(void 0===t._appid)return void i("No app-ID");void 0===o&&(o=ATON.PATCH_ADD);let p={};p.wappid=t._appid,p.fid=a,p.data=e,p.mode=o===ATON.PATCH_DEL?"DEL":"ADD";let r=JSON.stringify(p);$.ajax({url:ATON.PATH_RESTAPI+"patch/wapp",type:"POST",data:r,contentType:"application/json; charset=utf-8",dataType:"json",success:e=>{void 0!==e?(t._appdata[a]=e,d(e)):i("Error writing on server")}})}),getAppID:()=>t._appid,addToStorage:(a,e)=>t._sendDataPatch(a,e,ATON.PATCH_ADD),deleteFromStorage:(a,e)=>t._sendDataPatch(a,e,ATON.PATCH_DEL),getStorage:a=>new Promise((e,o)=>{void 0!==t._appid?void 0!==a?$.getJSON(ATON.PATH_WAPPS+t._appid+"/data/"+a+".json",o=>{console.log(o),t._appdata[a]=o,e(o)}):o("No storage ID specified"):o()})};var a=t;exports.default=a;
},{}],"yaoK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=h(require("./ATON.node.js")),o=h(require("./ATON.pov.js")),n=h(require("./ATON.lightprobe.js")),a=h(require("./ATON.eventhub.js")),t=h(require("./ATON.mathub.js")),i=h(require("./ATON.utils.js")),r=h(require("./ATON.scenehub.js")),d=h(require("./ATON.audiohub.js")),s=h(require("./ATON.nav.js")),_=h(require("./ATON.xr.js")),l=h(require("./ATON.sui.js")),c=h(require("./ATON.vroadcast.js")),u=h(require("./ATON.semfactory.js")),v=h(require("./ATON.fe.js")),S=h(require("./ATON.mediarec.js")),m=h(require("./ATON.geoloc.js")),p=h(require("./ATON.apphub.js"));function h(e){return e&&e.__esModule?e:{default:e}}let g={};window.ATON=g,g.Node=e.default,g.POV=o.default,g.LightProbe=n.default,g.EventHub=a.default,g.Utils=i.default,g.SceneHub=r.default,g.MatHub=t.default,g.Nav=s.default,g.AudioHub=d.default,g.XR=_.default,g.SUI=l.default,g.VRoadcast=c.default,g.SemFactory=u.default,g.FE=v.default,g.MediaRec=S.default,g.GeoLoc=m.default,g.AppHub=p.default,g.STD_UPVECTOR=new THREE.Vector3(0,1,0),g.ROOT_NID=".",g.RAD2DEG=180/Math.PI,g.DEG2RAD=Math.PI/180,g.PATCH_ADD=0,g.PATCH_DEL=1,g.NTYPES={},g.NTYPES.SCENE=3,g.NTYPES.SEM=4,g.NTYPES.UI=5,g.PATH_RESTAPI=window.location.origin+"/api/",g.PATH_RESTAPI_SCENE=g.PATH_RESTAPI+"scene/",g.PATH_WAPPS=window.location.origin+"/a/",g.PATH_MODS=window.location.origin+"/mods/",g.PATH_DRACO_LIB=window.location.origin+"/dist/draco/",g.PATH_BASIS_LIB=window.location.origin+"/dist/basis/",g.PATH_IFC_LIB=window.location.origin+"/dist/ifc/",g.PATH_COLLECTION=window.location.origin+"/collections/",g.PATH_SCENES=window.location.origin+"/scenes/",g.PATH_RES=window.location.origin+"/res/",g.PATH_FE=window.location.origin+"/fe/",g.SHADOWS_NEAR=.1,g.SHADOWS_FAR=50,g.SHADOWS_SIZE=15,g.SHADOWS_RES=1024,g.AMB_L=.1,g.setPathCollection=(e=>{g.PATH_COLLECTION=e}),g.setPathScenes=(e=>{g.PATH_SCENES=e}),g._onUserInteraction=(()=>{g._elPanoVideo&&!g._vpanoPlaying&&g._elPanoVideo.play(),"suspended"===g.AudioHub._listener.context.state&&g.AudioHub._listener.context.resume()}),g._setupBaseListeners=(()=>{let e=g._renderer.domElement;window.addEventListener("resize",g._onResize,!1),window.onorientationchange=g._readDeviceOrientationMode,screenfull.isEnabled&&screenfull.on("change",()=>{g._bFS=screenfull.isFullscreen,g.fireEvent("Fullscreen",g._bFS),g._bFS?console.log("Now fullscreen"):console.log("Exit fullscreen")}),e.addEventListener("mousemove",g._updateScreenMove,!1),e.addEventListener("mousedown",e=>{1===e.button&&g.fireEvent("MouseMidButton"),2===e.button&&g.fireEvent("MouseRightButton")}),e.addEventListener("wheel",g._onMouseWheel,!1),g._bPointerDown=!1,window.addEventListener("pointerdown",e=>{g._bPointerDown=!0,g._onUserInteraction()}),window.addEventListener("pointerup",e=>{g._bPointerDown=!1}),window.addEventListener("pointermove",e=>{g._bPointerDown&&(g._updateScreenMove(e),g._handleQueries())}),window.addEventListener("touchstart",e=>{g._bPointerDown=!0,g._onUserInteraction()}),window.addEventListener("touchend",e=>{g._bPointerDown=!1}),window.addEventListener("touchmove",e=>{g._bPointerDown&&(g._updateScreenMove(e.touches[0]),g._handleQueries())}),Hammer(e).on("doubletap",e=>{g._bPointerDown=!1,g.fireEvent("DoubleTap",e.srcEvent)}),Hammer(e).on("tap",e=>{if(g._bPointerDown=!1,g._onUserInteraction(),g._updateScreenMove(e.srcEvent),g._handleQueries(),g.fireEvent("Tap",e.srcEvent),void 0===g._hoveredUI)return;let o=g.getUINode(g._hoveredUI);o&&o.onSelect&&o.onSelect()}),g.on("DoubleTap",e=>{g.defaultDoubleTapFromScreenCoords(e)}),g._kModShift=!1,g._kModCtrl=!1,g._bListenKeyboardEvents=!0,window.addEventListener("keydown",e=>{g._onUserInteraction(),"Shift"===e.key&&(g._kModShift=!0),"Control"===e.key&&(g._kModCtrl=!0),g._bListenKeyboardEvents&&g.fireEvent("KeyPress",e.key)},!1),window.addEventListener("keyup",e=>{"Shift"===e.key&&(g._kModShift=!1),"Control"===e.key&&(g._kModCtrl=!1),g._bListenKeyboardEvents&&g.fireEvent("KeyUp",e.key)},!1),g.on("KeyPress",e=>{if("+"===e){let e=g.Nav.getFOV()+1;g.Nav.setFOV(e)}if("-"===e){let e=g.Nav.getFOV()-1;g.Nav.setFOV(e)}if("PageUp"===e){let e=g.SUI.mainSelector.scale.x+.02;g.SUI.setSelectorRadius(e)}if("PageDown"===e){let e=g.SUI.mainSelector.scale.x-.02;e=Math.max(e,.01),g.SUI.setSelectorRadius(e)}})}),g._onResize=(()=>{g.Nav._camera.aspect=window.innerWidth/window.innerHeight,g.Nav._camera.updateProjectionMatrix(),g._renderer.setSize(window.innerWidth,window.innerHeight),console.log("onResize")}),g._onMouseWheel=(e=>{e.preventDefault(),g.fireEvent("MouseWheel",e.deltaY)}),g.focusOn3DView=(()=>{g._renderer.domElement.focus()}),g._SUIactivation=(()=>{const e=g.getUINode(g._hoveredUI);return void 0!==e&&(void 0!==e.onSelect&&(e.onSelect(),!0))}),g._stdActivation=(()=>{if(g._SUIactivation())return;if(!g.Nav._bControl)return;if(g.XR._bPresenting)return"immersive-vr"===_.default._sessionType&&_.default.teleportOnQueriedPoint(),void g.FE.playAudioFromSemanticNode(g._hoveredSemNode);if(g.Nav.isFirstPerson()||g.Nav.isDevOri()){if(g.Nav.currentQueryValidForLocomotion()){let e=g._queryDataScene.p,o=g.Nav._vDir,n=new THREE.Vector3(e.x,e.y+g.userHeight,e.z),a=new THREE.Vector3(n.x+o.x,n.y+o.y,n.z+o.z),t=(new g.POV).setPosition(n).setTarget(a).setFOV(g.Nav._currPOV.fov);g.Nav.requestPOV(t,.5)}return}let e=g.getSemanticNode(g._hoveredSemNode);g._queryDataSem&&e?g.Nav.requestPOVbyNode(e,.5):g._queryDataScene&&g.Nav.requestRetarget(g._queryDataScene.p,void 0,.5)}),g.defaultDoubleTapFromScreenCoords=(e=>{g._updateScreenMove(e),g._handleQueryScene(),g._stdActivation()}),g.isFullscreen=(()=>g._bFS),g.toggleFullScreen=(()=>{screenfull.toggle()}),g.realize=(()=>{console.log("Initialize ATON..."),g.Utils.init(),g.Utils.profileDevice(),g._clock=new THREE.Clock(!0),g._bFS=!1;g._renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0,powerPreference:"high-performance"}),g._renderer.setSize(window.innerWidth,window.innerHeight),g._stdpxd=1,g._renderer.setPixelRatio(g._stdpxd),g._fps=60,g._dt=.01,g._dtAccum=0,g._avgFPScount=0,g._avgFPSaccum=0,g._avgFPS=60,g._bDynamicDensity=!1,g._aniMixers=[],g._renderer.outputEncoding=THREE.sRGBEncoding,g._renderer.toneMapping=THREE.LinearToneMapping,g._renderer.toneMappingExposure=1,g._renderer.setAnimationLoop(g._onFrame),g._maxAnisotropy=g._renderer.capabilities.getMaxAnisotropy(),console.log(g._renderer.capabilities),THREE.Cache.enabled=!0,g.userHeight=1.7,document.body.appendChild(g._renderer.domElement);let e=g._renderer.domElement;e.style.outline="none",e.style.border="none",g._vpanoPlaying=!1,g._bUserInts=0,g.EventHub.init(),g.MatHub.init(),g._assetsManager={},g._aLoader=new THREE.GLTFLoader,g._dracoLoader=new THREE.DRACOLoader,g._dracoLoader.setDecoderPath(g.PATH_DRACO_LIB),g._aLoader.setDRACOLoader(g._dracoLoader),g._numReqLoad=0,g._ccModels=[],g._updRoutines=[],g._lps=[],g._bAutoLP=!1,g._envMapInt=1,g._bShadowsFixedBound=!1,g._shadowsNear=g.SHADOWS_NEAR,g._shadowsFar=g.SHADOWS_FAR,g._shadowsSize=g.SHADOWS_SIZE,g._shadowsRes=g.SHADOWS_RES,g.initGraphs(),g.SceneHub.init(),g._tsets=[],g.AudioHub.init(),g.Nav.init(),g.XR.init(),g.SUI.init(),g.VRoadcast.init(),g.MediaRec.init(),g.SemFactory.init(),g.AppHub.init(),g.GeoLoc.init(),g._queryDataScene=void 0,g._queryDataSem=void 0,g._queryDataUI=void 0,g._hoveredSemNode=void 0,g._hoveredUI=void 0,g._bQuerySemOcclusion=!0,g._bQueryNormals=!0,g._bPauseQuery=!1,g._bqScene=!1,g._bqSem=!1,g._tgiDur=void 0,g._tgiPer=void 0,g._tHover=void 0,g._bMainPanoInfinite=!0,g._matMainPano=void 0,g._mMainPano=void 0,g._screenPointerCoords=new THREE.Vector2(0,0),g._rcScene=new THREE.Raycaster,g._rcScene.layers.set(g.NTYPES.SCENE),g._rcSemantics=new THREE.Raycaster,g._rcSemantics.layers.set(g.NTYPES.SEM),g._rcUI=new THREE.Raycaster,g._rcUI.layers.set(g.NTYPES.UI),g._registerRCS(),g._setupBaseListeners(),g.device.isMobile&&g._readDeviceOrientationMode(),g._wappID=void 0,g.focusOn3DView()}),g.setTimedGazeDuration=(e=>{g._tgiDur=e}),g.getTimedGazeProgress=(()=>{if(void 0!==g._tgiDur)return g._tgiPer}),g.getElapsedTime=(()=>g._clock.elapsedTime),g.renderPause=(()=>{g._renderer.setAnimationLoop(void 0)}),g.renderResume=(()=>{g._renderer.setAnimationLoop(g._onFrame)}),g._setupLoadManager=(()=>{g._loadManager=new THREE.LoadingManager,g._loadManager.onStart=((e,o,n)=>{console.log("Started loading file: "+e+".\nLoaded "+o+" of "+n+" files."),g.fireEvent("NodeRequestFired",e)}),g._loadManager.onLoad=(()=>{console.log("Loading complete!"),g.fireEvent("AllNodeRequestsCompleted")}),g._loadManager.onProgress=((e,o,n)=>{}),g._loadManager.onError=(e=>{console.log("There was an error loading "+e)})}),g.setDefaultPixelDensity=(e=>{g._stdpxd=e,g._renderer.setPixelRatio(e),void 0!==g._renderer.xr&&(g.device.isMobile?g._renderer.xr.setFramebufferScaleFactor(g._stdpxd*g.XR.MOBILE_DENSITY_F):g._renderer.xr.setFramebufferScaleFactor(g._stdpxd))}),g.resetPixelDensity=(()=>{g._renderer.setPixelRatio(g._stdpxd)}),g._readDeviceOrientationMode=(()=>{90===Math.abs(window.orientation)?(console.log("Landscape Mode"),g.fireEvent("MobileLandscapeMode")):(console.log("Portrait Mode"),g.fireEvent("MobilePortraitMode")),setTimeout(g._onResize,500)}),g.snodes={},g.semnodes={},g.uinodes={},g.createSceneNode=(e=>new g.Node(e,g.NTYPES.SCENE)),g.getSceneNode=(e=>{if(void 0!==e)return g.snodes[e]}),g.getOrCreateSceneNode=(e=>{let o=g.getSceneNode(e);return void 0!==o?o:g.createSceneNode(e)}),g.getRootScene=(()=>g._rootVisible),g.createSemanticNode=(e=>new g.Node(e,g.NTYPES.SEM)),g.getSemanticNode=(e=>{if(void 0!==e)return g.semnodes[e]}),g.getOrCreateSemanticNode=(e=>{let o=g.getSemanticNode(e);return void 0!==o?o:g.createSemanticNode(e)}),g.getRootSemantics=(()=>g._rootSem),g.createUINode=(e=>new g.Node(e,g.NTYPES.UI)),g.getUINode=(e=>{if(void 0!==e)return g.uinodes[e]}),g.getRootUI=(()=>g._rootUI),g._assetReqNew=(e=>{g._numReqLoad++,g.fireEvent("NodeRequestFired",e)}),g._assetReqComplete=(e=>{g.fireEvent("NodeRequestCompleted",e),g._numReqLoad--,g._numReqLoad<=0&&g._onAllReqsCompleted()}),g._onAllReqsCompleted=(()=>{let e=g._rootVisible.getBound().center,o=g._rootVisible.getBound().radius;g._renderer.shadowMap.enabled&&(g._rootVisible.traverse(e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)}),g.adjustShadowsParamsFromSceneBounds(),g._bShadowsFixedBound&&g.updateDirShadows(e)),g._bAutoLP&&(void 0===g._lps[0]?g.addLightProbe((new g.LightProbe).setPosition(e).setNear(o)):g._lps[0].setPosition(e.x,e.y,e.z).setNear(o),console.log("Auto LP")),e&&g._mMainPano&&g._mMainPano.position.copy(e),g.getRootScene().assignLightProbesByProximity(),g.fireEvent("AllNodeRequestsCompleted"),g._postAllReqsCompleted(),setTimeout(()=>{g.updateLightProbes(),g._renderer.shadowMap.enabled&&g._bShadowsFixedBound&&0===g._aniMixers.length&&(g._dMainL.shadow.autoUpdate=!1,console.log("Lazy shadows"))},1e3)}),g._postAllReqsCompleted=(e=>{void 0===e&&(e=g._rootVisible);for(let o in e.children){let n=e.children[o];n&&n.toggle&&(g._postAllReqsCompleted(n),n.toggle(n.visible))}}),g.initGraphs=(()=>{g._mainRoot=new THREE.Scene,g._mainRoot.background=new THREE.Color(.7,.7,.7),g._rootVisibleGlobal=new THREE.Group,g._mainRoot.add(g._rootVisibleGlobal),g._rootVisible=g.createSceneNode().setAsRoot(),g._rootVisibleGlobal.add(g._rootVisible),g._rootSem=g.createSemanticNode().setAsRoot(),g._mainRoot.add(g._rootSem),g._rootUI=g.createUINode().setAsRoot(),g._mainRoot.add(g._rootUI),g.ambLight=new THREE.AmbientLight(new THREE.Color(1,1,1)),g._rootVisibleGlobal.add(g.ambLight)}),g.setBackgroundColor=(e=>{g._mainRoot.background=e}),g.setAutoLP=(e=>{g._bAutoLP=e}),g.setNeutralAmbientLight=(e=>{g.ambLight.color=new THREE.Color(e,e,e)}),g.addLightProbe=(e=>{void 0!==e&&(0===g._lps.length&&g.setNeutralAmbientLight(g.AMB_L),g._lps.push(e),void 0!==g.SUI.gLPIcons&&l.default.addLPIcon(e))}),g.updateLightProbes=(()=>{if(0!==g._lps.length){for(let e in g._lps)g._lps[e].update();g._lps[0]&&(g._indLP&&g._mainRoot.remove(g._indLP),g._indLP=THREE.LightProbeGenerator.fromCubeRenderTarget(g._renderer,g._lps[0]._prevCCtarget),g._indLP.intensity=1,g._mainRoot.add(g._indLP)),g._rootVisible.traverse(e=>{let o=e.userData.LP;void 0!==o&&o instanceof g.LightProbe&&(e.material.envMap=o.getEnvTex(),e.material.combine=THREE.AddOperation,e.material.envMapIntensity=g._envMapInt)}),console.log("LPs updated.")}}),g.setMainPanorama=(e=>{let o=void 0;e=g.Utils.resolveCollectionURL(e),void 0===g._mMainPano&&(g._gMainPano=new THREE.SphereBufferGeometry(1,60,60),g._gMainPano.castShadow=!1,g._gMainPano.receiveShadow=!1,g._mMainPano=new THREE.Mesh(g._gMainPano,g._matMainPano),g._mMainPano.frustumCulled=!1,g._mMainPano.renderOrder=-100,g.setMainPanoramaRadius(.8*g.Nav.STD_FAR)),g.Utils.isVideo(e)?(void 0===g._elPanoVideo&&(g._elPanoVideo=document.createElement("video"),g._elPanoVideo.id="idPanoVideo",g._elPanoVideo.innerHTML="<source src='"+e+"'>",g._elPanoVideo.crossOrigin="anonymous",g._elPanoVideo.loop=!0,g._elPanoVideo.playsinline=!0,g._elPanoVideo.style.cssText="display:none;",g._elPanoVideo.autoplay=!0,g._elPanoVideo.onplaying=(()=>{console.log("VideoPano playing"),g._vpanoPlaying=!0})),(o=new THREE.VideoTexture(g._elPanoVideo)).encoding=THREE.sRGBEncoding,g._realizeOrUpdateMainPano(o)):g.Utils.textureLoader.load(e,e=>{e.encoding=THREE.sRGBEncoding,e.generateMipmaps=!0,g._realizeOrUpdateMainPano(e)})}),g._realizeOrUpdateMainPano=(e=>{void 0===g._matMainPano?(g._matMainPano=new THREE.MeshBasicMaterial({map:e,depthTest:!1,depthWrite:!1}),g._mMainPano.material=g._matMainPano,g._bMainPanoInfinite&&(g._mMainPano.onAfterRender=(()=>{g.Nav._currPOV&&g._mMainPano.position.copy(g.Nav._currPOV.pos)})),g._rootVisibleGlobal.add(g._mMainPano)):g._matMainPano.map=e}),g.setMainPanoramaRadius=(e=>{void 0!==g._gMainPano&&g._gMainPano.scale(-e,e,e)}),g.setMainPanoramaRotation=(e=>{void 0!==g._mMainPano&&g._mMainPano.rotation.set(0,e,0)}),g.setMainPanoramaInfinite=(e=>{g._bMainPanoInfinite=e,void 0!==g._mMainPano&&(g._mMainPano.onAfterRender=e?()=>{g.Nav._currPOV&&g._mMainPano.position.copy(g.Nav._currPOV.pos)}:void 0)}),g.setMainPanoramaLocation=(e=>{g._bMainPanoInfinite||void 0!==g._mMainPano&&g._mMainPano.position.copy(e)}),g.setMainLightDirection=(e=>{let o=e.clone();o.normalize(),o.x*=.5*g.SHADOWS_FAR,o.y*=.5*g.SHADOWS_FAR,o.z*=.5*g.SHADOWS_FAR,void 0===g._dMainL&&(g._dMainL=new THREE.DirectionalLight(new THREE.Color(1,1,1),1),g._dMainL.castShadow=!1,g._dMainLtgt=new THREE.Object3D,g._rootVisibleGlobal.add(g._dMainLtgt),g._dMainL.target=g._dMainLtgt,g._rootVisibleGlobal.add(g._dMainL),g._dMainLpos=new THREE.Vector3),g._dMainLdir=o,g._dMainL.position.set(-o.x,-o.y,-o.z),g._renderer.shadowMap.enabled&&(g._dMainL.shadow.needsUpdate=!0),g.toggleMainLight(!0)}),g.getMainLightDirection=(()=>{if(void 0===g._dMainLdir)return;let e=g._dMainLdir.clone();return e.normalize(),e}),g.toggleMainLight=(e=>{void 0!==g._dMainL&&(g._dMainL.visible=e,e?(g.setNeutralAmbientLight(g.AMB_L),g.updateDirShadows()):g.setNeutralAmbientLight(1))}),g.isMainLightEnabled=(()=>void 0!==g._dMainL&&!!g._dMainL.visible),g.setExposure=(e=>{g._renderer.toneMappingExposure=e}),g.getExposure=(()=>g._renderer.toneMappingExposure),g.adjustShadowsParamsFromSceneBounds=(()=>{let e=g._rootVisible.getBound().radius;g._rootVisible.getBound().center;e<=0||e>=g.SHADOWS_SIZE?(g._bShadowsFixedBound=!1,g._shadowsSize=g.SHADOWS_SIZE):(g._bShadowsFixedBound=!0,g._shadowsSize=1.5*e),g._dMainL.shadow.map&&(g._dMainL.shadow.map.dispose(),g._dMainL.shadow.map=null),g._dMainL.shadow.camera.left=-g._shadowsSize,g._dMainL.shadow.camera.right=g._shadowsSize,g._dMainL.shadow.camera.bottom=-g._shadowsSize,g._dMainL.shadow.camera.top=g._shadowsSize,g._dMainL.shadow.mapSize.width=g._shadowsRes,g._dMainL.shadow.mapSize.height=g._shadowsRes,g._dMainL.shadow.camera.near=g._shadowsNear,g._dMainL.shadow.camera.far=g._shadowsFar,g._dMainL.shadow.bias=-5e-4}),g.toggleShadows=(e=>{if(void 0!==g._dMainL)if(e){if(g._dMainL.castShadow=!0,g._renderer.shadowMap.enabled=!0,g.device.isMobile?g._renderer.shadowMap.type=THREE.PCFShadowMap:g._renderer.shadowMap.type=THREE.PCFSoftShadowMap,g._rootVisible.traverse(e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)}),g.adjustShadowsParamsFromSceneBounds(),g._bShadowsFixedBound){let e=g._rootVisible.getBound().center;g.updateDirShadows(e)}else g.updateDirShadows();g._dMainL.shadow.needsUpdate=!0,console.log("Shadows ON")}else g._dMainL.castShadow=!1,g._renderer.shadowMap.enabled=!1,console.log("Shadows OFF")}),g.updateDirShadows=(e=>{void 0!==g._dMainLdir&&(void 0===e?(e=g.Nav.getCurrentEyeLocation(),g._dMainLpos.x=e.x+g.Nav._vDir.x*g._shadowsSize,g._dMainLpos.y=e.y+g.Nav._vDir.y*g._shadowsSize,g._dMainLpos.z=e.z+g.Nav._vDir.z*g._shadowsSize):(g._dMainLpos.x=e.x,g._dMainLpos.y=e.y,g._dMainLpos.z=e.z),g._dMainL.position.set(g._dMainLpos.x-g._dMainLdir.x,g._dMainLpos.y-g._dMainLdir.y,g._dMainLpos.z-g._dMainLdir.z),g._dMainLtgt.position.copy(g._dMainLpos))}),g._updateEnvironment=(()=>{g._renderer.shadowMap.enabled&&(g._bShadowsFixedBound||g.updateDirShadows())}),g.setGlobalAudio=((e,o)=>{void 0!==e&&(void 0===o&&(o=!0),e=g.Utils.resolveCollectionURL(e),void 0===g._auMain||null===g._auMain?g._auMain=new THREE.Audio(g.AudioHub._listener):g._auMain.isPlaying&&g._auMain.stop(),g.AudioHub._loader.load(e,e=>{g._auMain.setBuffer(e),g._auMain.setLoop(o),g._auMain.play()}))}),g._markFPS=(()=>{if(g._numReqLoad>0)return;const e=1/g._dt;if(g._avgFPScount+=1,g._dtAccum+=g._dt,g._avgFPSaccum+=e,g._dtAccum<1)return;if(g._fps=g._avgFPSaccum/g._avgFPScount,g._avgFPSaccum=0,g._avgFPScount=0,g._dtAccum=0,!g._bDynamicDensity)return;let o=g._renderer.getPixelRatio();g._fps<30&&(o*=.75)>=.1&&(g._renderer.setPixelRatio(o),console.log(o)),g._fps>50&&(o*=1.33)<=g._stdpxd&&(g._renderer.setPixelRatio(o),console.log(o))}),g._onFrame=(()=>{g._dt=g._clock.getDelta(),g._markFPS(),g.XR._bPresenting?g.XR.update():g.Nav._controls.update(g._dt),g._handleQueries(),g.Nav.update(),g.VRoadcast.update(),g.SUI.update(),g.MatHub.update(),g._updateEnvironment(),g._updateAniMixers(),g._updateRoutines(),g._updateTSets(),g._renderer.render(g._mainRoot,g.Nav._camera)}),g.addUpdateRoutine=(e=>{void 0!==e&&g._updRoutines.push(e)}),g.deleteAllUpdateRoutines=(()=>{g._updRoutines=[]}),g._updateRoutines=(()=>{let e=g._updRoutines.length;if(!(e<=0))for(let o=0;o<e;o++)g._updRoutines[o]()}),g._updateTSets=(()=>{const e=g._tsets.length;if(!(e<=0)){g.Nav._camera.updateMatrixWorld();for(let o=0;o<e;o++){g._tsets[o].update()}}}),g._updateAniMixers=(()=>{let e=g._aniMixers.length;if(!(e<1))for(let o=0;o<e;o++){g._aniMixers[o].update(g._dt)}}),g._updateScreenMove=(e=>{if(e.preventDefault&&e.preventDefault(),g.Nav._mode===g.Nav.MODE_DEVORI)return g._screenPointerCoords.x=0,void(g._screenPointerCoords.y=0);g._screenPointerCoords.x=e.clientX/window.innerWidth*2-1,g._screenPointerCoords.y=-e.clientY/window.innerHeight*2+1}),g._registerRCS=(()=>{g._rcRR=0,g._rcHandlers=[],g._rcHandlers.push(g._handleQueryScene),g._rcHandlers.push(g._handleQuerySemantics),g._rcHandlers.push(g._handleQueryUI)}),g._handleQueries=(()=>{if(g._bPauseQuery)return;if(g.Nav._bInteracting)return;if(g._numReqLoad>0)return;if(g.Nav.isTransitioning())return;if(g._handleQueryUI(),g._bqScene&&g._handleQueryScene(),g._bqSem&&g._handleQuerySemantics(),g.Nav.locomotionValidator(),void 0===g._tgiDur)return;if(void 0===g._tHover)return;const e=g._clock.elapsedTime-g._tHover;e>=g._tgiDur?(g._stdActivation(),g._tHover=void 0,g._tgiPer=void 0):g._tgiPer=e/g._tgiDur}),g._handleQueryScene=(()=>{if(g.XR.isPresenting()?g.XR.setupQueryRay(g._rcScene):g._rcScene.setFromCamera(g._screenPointerCoords,g.Nav._camera),g._hitsScene=[],g._rcScene.intersectObjects(g._mainRoot.children,!0,g._hitsScene),g._hitsScene.length<=0)return void(g._queryDataScene=void 0);const e=g._hitsScene[0];g._queryDataScene={},g._queryDataScene.p=e.point,g._queryDataScene.d=e.distance,g._queryDataScene.o=e.object,g._bQueryNormals&&null!==e.face&&void 0!==e.face.normal&&(g._queryDataScene.matrixWorld=(new THREE.Matrix3).getNormalMatrix(e.object.matrixWorld),g._queryDataScene.n=e.face.normal.clone().applyMatrix3(g._queryDataScene.matrixWorld).normalize())}),g.getSceneQueriedPoint=(()=>{if(void 0!==g._queryDataScene)return g._queryDataScene.p}),g.getSceneQueriedDistance=(()=>{if(void 0!==g._queryDataScene)return g._queryDataScene.d}),g.getSceneQueriedNormal=(()=>{if(void 0!==g._queryDataScene)return g._queryDataScene.n}),g._handleQuerySemantics=(()=>{if(g.XR.isPresenting()?g.XR.setupQueryRay(g._rcSemantics):g._rcSemantics.setFromCamera(g._screenPointerCoords,g.Nav._camera),g._hitsSem=[],g._rcSemantics.intersectObjects(g._mainRoot.children,!0,g._hitsSem),g._hitsSem.length<=0){if(g._queryDataSem=void 0,g._hoveredSemNode){g.fireEvent("SemanticNodeLeave",g._hoveredSemNode);let e=g.getSemanticNode(g._hoveredSemNode);e&&e.onLeave&&e.onLeave()}return g._hoveredSemNode=void 0,void(g._tHover=void 0)}const e=g._hitsSem[0];if(g._bQuerySemOcclusion&&g._queryDataScene&&g._queryDataScene.d<e.distance){if(g._queryDataSem=void 0,g._hoveredSemNode){g.fireEvent("SemanticNodeLeave",g._hoveredSemNode);let e=g.getSemanticNode(g._hoveredSemNode);e&&e.onLeave&&e.onLeave()}return g._hoveredSemNode=void 0,void(g._tHover=void 0)}g._queryDataSem={},g._queryDataSem.p=e.point,g._queryDataSem.d=e.distance,g._queryDataSem.o=e.object,g._queryDataSem.list=[];const o=g._queryDataSem.list;let n=e.object.parent;for(;n;)n.nid&&n.nid!==g.ROOT_NID&&o.push(n.nid),n=n.parent;const a=o[0];if(a&&g._hoveredSemNode!==a){if(g._hoveredSemNode){g.fireEvent("SemanticNodeLeave",g._hoveredSemNode);let e=g.getSemanticNode(g._hoveredSemNode);e&&e.onLeave&&e.onLeave(),g._tHover=void 0}g._hoveredSemNode=a,g.fireEvent("SemanticNodeHover",a);let e=g.getSemanticNode(a);e&&e.onHover&&e.onHover(),g._tHover=g._clock.elapsedTime}}),g._handleQueryUI=(()=>{if(g.XR.isPresenting()?g.XR.setupQueryRay(g._rcUI):g._rcUI.setFromCamera(g._screenPointerCoords,g.Nav._camera),g._hitsUI=[],g._rcUI.intersectObjects(g._mainRoot.children,!0,g._hitsUI),g._hitsUI.length<=0){if(g._queryDataUI=void 0,g._hoveredUI){g.fireEvent("UINodeLeave",g._hoveredUI);const e=g.getUINode(g._hoveredUI);e&&e.onLeave&&e.onLeave()}return g._hoveredUI=void 0,void(g._tHover=void 0)}const e=g._hitsUI[0];if(g._queryDataScene&&g._queryDataScene.d<e.distance){if(g._queryDataUI=void 0,g._hoveredUI){g.fireEvent("UINodeLeave",g._hoveredUI);const e=g.getUINode(g._hoveredUI);e&&e.onLeave&&e.onLeave()}return g._hoveredUI=void 0,void(g._tHover=void 0)}g._queryDataUI={},g._queryDataUI.p=e.point,g._queryDataUI.d=e.distance,g._queryDataUI.o=e.object,g._queryDataUI.list=[];const o=g._queryDataUI.list;let n=e.object.parent;for(;n;)n.nid&&n.nid!==g.ROOT_NID&&o.push(n.nid),n=n.parent;const a=o[0];if(a&&g._hoveredUI!==a){if(g._hoveredUI){g.fireEvent("UINodeLeave",g._hoveredUI);const e=g.getUINode(g._hoveredUI);e&&e.onLeave&&e.onLeave(),g._tHover=void 0}g._hoveredUI=a,g.fireEvent("UINodeHover",a);const e=g.getUINode(a);e&&e.onHover&&e.onHover(),g._tHover=g._clock.elapsedTime}});var M=g;exports.default=M;
},{"./ATON.node.js":"XTSP","./ATON.pov.js":"CwXu","./ATON.lightprobe.js":"MNcy","./ATON.eventhub.js":"LryX","./ATON.mathub.js":"R8yv","./ATON.utils.js":"P9TA","./ATON.scenehub.js":"qC8Z","./ATON.audiohub.js":"mYhb","./ATON.nav.js":"nomA","./ATON.xr.js":"jROx","./ATON.sui.js":"xSlA","./ATON.vroadcast.js":"mY3J","./ATON.semfactory.js":"dQQK","./ATON.fe.js":"Z6YW","./ATON.mediarec.js":"jdcn","./ATON.geoloc.js":"uZX1","./ATON.apphub.js":"Iy9y"}]},{},["yaoK"], null)
//# sourceMappingURL=/ATON.min.js.map